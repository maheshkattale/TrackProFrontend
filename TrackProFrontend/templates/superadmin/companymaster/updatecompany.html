
{% extends "index.html" %}
{% load static %} 
{% block content %}


<style>
      
    .head {
        background-color: #f1f1f1;
    }
    
    th {
        /* background: #007cb9 !important; */
        color: black;
        padding: 15px;
        /* text-align: center; */
        max-width: 500px;
        /* width: 300px; */
        background-color: gray;
    }
    /* .dataTables_info{
  background-color: #f4f4f4;
}
.dataTables_paginate {
  background-color: #f4f4f4;

} */
    
    select {
        -webkit-appearance: none !important;
        -moz-appearance: none !important;
        appearance: none !important;
    }
    
    .dataTables_info {
        padding: 0 !important;
    }
    
    .table.dataTable {
        margin-top: 0px !important;
        margin-bottom: 0px !important;
    }
    
    div#dataTable_filter {
        float: right;
        margin-right: 15px;
        margin-top: 0px;
    }
    /* .thfs{
   
    color: white;
    text-align: center;
    padding: 15px;
    width:300px;
    border-radius: 5px 0px 0px 0px;
}
.thls{
   
    color: white;
    text-align: center;
    
    padding: 15px;
    width:300px;
    border-radius: 0px 5px 0px 0px;
} */
    
    .highlight {
        background-color: skyblue;
    }
    
    #example {}
    
    #example_filter input[type="search"] {
        border: none;
        border-radius: 0px;
        border-bottom: 2.2px solid #1d87ad;
        color: white;
        padding: 5px;
        outline: none;
        background-color: transparent;
    }
    
    .row1 {
        background: rgb(34, 34, 34);
        background: linear-gradient(180deg, rgba(34, 34, 34, 1) 0%, rgba(78, 78, 78, 1) 100%, rgba(255, 255, 255, 1) 100%);
        padding: 10px;
        color: white;
        border-radius: 13px 13px 0px 0px;
        align-items: center;
    }
    
    .dataTables_wrapper {}
    
    select::-ms-expand {
        display: none !important;
    }
    
    select::-ms-expand {
        display: none;
    }
    
    #example_filter input[type="search"]:focus {
        border-color: inherit;
        -webkit-box-shadow: none;
        box-shadow: none;
        border-bottom: 2px solid #174fa3;
    }
    
    #example_length select {
        border: none;
        color: #174fa3;
        background-color: transparent;
        border-bottom: 2px solid #174fa3;
        border-radius: 0px;
        border-color: inherit;
        box-shadow: none;
        text-align: center;
        height: 30px;
    }
    
    #example_datatable {
        background-color: black;
    }
    
    .table.dataTable thead th {
        padding: 10px;
        font-weight: 500;
        font-size: 16px;
    }
    
    table.dataTable tbody th,
    table.dataTable tbody td {
        padding: 0.5rem 0.5rem;
    }
    
    table td {
        font-size: 14px !important;
        font-weight: 400 !important;
        text-align: center;
    }
    
    .table.dataTable thead>tr>th.sorting {
        padding-right: 0 !important;
        text-align: center;
    }
    
    .rowl {
        background: #f1f1f1;
        align-items: center;
        padding: 5px;
    }
    
    .btn-close {
        font-size: 14px;
    }
    
    .error-message {
        color: red;
    }
    .maincontainer{
        background-color: white;
        margin: 0px 20px;
        padding: 50px 30px;
        box-shadow: 0 0 10px #0000001f;
        border-radius: 1rem;

    }
    .excelgstbtn{
        background-color: white;
        color:#7f8fa6;;
        border:1px solid #7f8fa6;
        padding: 0.6rem;
        /* margin:100%; */
        width:100%;
        font-weight: 500;
    }
    .imagediv{
        text-align:center;
    }
    .spnfilename{
       text-align: center;
    }
    .excelgstbtn:hover{
        border:1px solid #174fa3 !important;
        outline:none !important;
        box-shadow:none !important;
    }
    .excelgstbtn:focus{
        border:1px solid #174fa3 !important;
        outline:none !important;
        box-shadow:none !important;
    }
   
    
</style>
<link rel="stylesheet" href="{% static 'assets/css/superadminstyle.css' %}">

<main class="main-wrapper">
    {% if messages %}
    <div class="row" style="justify-content: center;">
        <div class="col-sm-6 col-sm-offset-3">
        {% for message in messages %}
        <div style="display: flex; margin: 15px 0px;flex-direction: row-reverse;justify-content: center;align-items: center;" class="alert alert-{{ message.tags }} alert-dismissible text-center" role="alert">
            <button type="button" class="close" data-dismiss="alert" aria-label="Close" style="background: transparent; border: none; font-size: 25px; color: #ff0000;">
            <span aria-hidden="true">&times;</span>
            </button>
            <p style="margin-bottom: 0px;">{{ message }}</p>
        </div>
        {% endfor %}
        </div>
    </div>
    {% endif %}
      
               <div class="d-flex ms-4 my-3">
                   <h5>Update Company</h5>
               </div>
             
          
       <div class="maincontainer">
       <form method="post" enctype="multipart/form-data">
           {%csrf_token%}
       <div class="row ">
           <div class="col-md-4"><div class="did-floating-label-content did-error-input">
               <input type="text"   id="companyname" name="companyname" value="{{companyInfo.companyName}}" placeholder=" " style="height:45px" class="did-floating-input"/>
               <label class="did-floating-label">Company Name</label>
               <span class="error" id="companyname_err"></span>
           </div></div>
           <div class="col-md-4"><div class="did-floating-label-content did-error-input">
               <input type="text" id="gstNumber" required="required" name="gstNumber"  value="{{companyInfo.gstNumber}}" placeholder=" " style="height:45px" class="did-floating-input"/>
               <label class="did-floating-label">GSTIN Number</label>
               <span class="error" id="gstNumber_err"></span>
           </div></div>
           <div class="col-md-4"><div class="did-floating-label-content did-error-input">
               <input type="Email"   id="memberadmin" required="required" name="memberadmin" value="{{companyInfo.memberadmin}}" placeholder=" " style="height:45px" class="did-floating-input"/>
               <label class="did-floating-label">Comapny Admin</label>
               <span class="error" id="memberadmin_err"></span>
           </div></div>
       </div>
       <div class="row row2">
           <div class="col-md-4"><div class="did-floating-label-content did-error-input">
               <input type="text"   id="adhaarNumber" required="required" name="adhaarNumber" value="{{companyInfo.adhaarNumber}}" placeholder=" " style="height:45px" class="did-floating-input"/>
               <label class="did-floating-label">Adhaar Number</label>
               <span class="error" id="adhaarNumber_err"></span>
           </div></div>
       <div class="col-md-4"><div class="did-floating-label-content did-error-input">
               <input type="text"   id="caddress" required="required" name="caddress" value="{{companyInfo.companyAddress}}" placeholder=" " style="height:45px" class="did-floating-input"/>
               <label class="did-floating-label">Comapny Address</label>
               <span class="error" id="caddress_err"></span>
           </div></div>
       <div class="col-md-4"><div class="did-floating-label-content did-error-input">
                   <input type="text"   id="panNumber" required="required" name="panNumber"  value="{{companyInfo.panNumber}}" placeholder=" " style="height:45px" class="did-floating-input"/>
                   <label class="did-floating-label">Pan Card Number</label>
                   <span class="error" id="panNumber_err"></span>
               </div></div>
       </div>
      
       <div class="row row3">
           <div class="col-md-4">
               <div class="did-floating-label-content did-error-input">
                   <select class="floating-select" id="companyType" name="companyType" onclick="this.setAttribute('value', this.value);" style="color:#7f8fa6;" placeholder=" " style="height:45px" />
                     <option value=""></option>
                     {%for c in companytypelist%}
                     {%if c.companyType == companyInfo.companyType%}
                     <option value="{{c.companyType}}" selected>{{c.companyType}}</option>
                     {%else%}
                     <option value="{{c.companyType}}">{{c.companyType}}</option>
                     {%endif%}
                     {%endfor%}
                   </select>
                   
                   <label class="did-floating-label">Company Type</label>
                 </div>    
                 <span class="error" id="companyType_err"></span>   
          
       </div>
        <!-- GST certificate -->

           <div class="col-md-4">
            {% if companyInfo.gstcertificate == None %}
            <input type="file" name="gstcertificate" id="gstcertificate" class="form-control-file" onchange="document.getElementById('gstcertificatePreview').src = window.URL.createObjectURL(this.files[0])" data-file_types="jpg|jpeg|png|ico|bmp" hidden="hidden" />
            <button type="button" id="fileName" class="btn excelgstbtn">GST Certificate</button>
             <div class="spnfilename">
                <span id="custom-text">No file chosen, yet.</span>
            </div>
            <div class="imagediv mt-1">
                <img id="gstcertificatePreview" src="{%static 'assets/img/dummy-image.png'%}" class="preview-img" width="40%" alt text = "No Certificate">
            </div>
            {%else%}

            <input type="file" name="gstcertificate" id="gstcertificate" class="form-control-file" onchange="document.getElementById('gstcertificatePreview').src = window.URL.createObjectURL(this.files[0])" data-file_types="jpg|jpeg|png|ico|bmp" hidden="hidden" />
            <button type="button" id="fileName" class="btn excelgstbtn">GST Certificate</button>
             <div class="spnfilename"><span id="custom-text"></span></div>
            <div class="imagediv mt-1">
                <img id="gstcertificatePreview" src="{{companyInfo.gstcertificate}}" class="preview-img" width="40%" alt text = "No Certificate">
            </div>
            {%endif%}
            <!-- <input type="file" class="form-control" id="customFile" name="gstcertificate"/>
            <img src="{{companyInfo.gstcertificate}}" width="150px" class="mt-4"/> -->
        </div>
       
        <!-- Company logo -->

        <div class="col-md-4">
            {% if companyInfo.companylogos == None %}
            <input type="file" name="companylogos" id="companylogos" class="form-control-file" onchange="document.getElementById('companylogosPreview').src = window.URL.createObjectURL(this.files[0])" data-file_types="jpg|jpeg|png|ico|bmp" hidden="hidden" />
            <button type="button" id="logofileName" class="btn excelgstbtn">Company Logo</button>
            <div class="spnfilename"><span  id="logocustom-text">No file chosen, yet.</span></div>
            <div class="imagediv mt-1">
                <img id="companylogosPreview" src="{%static 'assets/img/dummy-image.png'%}" class="preview-img" width="40%" alt text = "No Certificate">
            </div>
            <p id="inputGroupFile_e" class="error"></p> 
            {%else%}
            <input type="file" name="companylogos" id="companylogos" class="form-control-file" onchange="document.getElementById('companylogosPreview').src = window.URL.createObjectURL(this.files[0])" data-file_types="jpg|jpeg|png|ico|bmp" hidden="hidden" />
            <button type="button" id="logofileName" class="btn excelgstbtn">Company Logo</button>
            <div class="spnfilename"><span  id="logocustom-text"></span></div>
            <div class="imagediv mt-1">
                <img id="companylogosPreview" src="{{companyInfo.companylogos}}" class="preview-img" width="40%" alt text = "No Certificate">
            </div>
            <p id="inputGroupFile_e" class="error"></p> 
            {%endif%}
            <!-- <input type="file" class="form-control" id="inputGroupFile" name="companylogos"/>
            <img src="{{companyInfo.companylogos}}" width="150px" class="mt-4"/> -->
        </div>

       </div>
       {% if companyInfo.period == "" %}
       <div class="mt-5">
       
           <div class="row row2">
            <div class="position-relative form-group">
                <h5 style="padding-left: 15px;">Payment Section</h5>
                </div>
           <div class="col-md-4 mt-4">
           <div class="floating-label">
            <select class="floating-select" onclick="this.setAttribute('value', this.value);" id="period" style="color:#7f8fa6;" onchange="getamountbyperiod();" value="" name="period">
                <option value=""></option>
                {%for p in periodlist%}
                <option value="{{p.period}}">{{p.period}}</option>
                {%endfor%}
            </select>
            <label class="did-floating-label" class="dropdown-label" >Plan Period</label>
        </div>
        </div>
           <div class="col-md-4 mt-4">
            <div class="did-floating-label-content did-error-input">
                <input type="text" id="payment" name="payment" placeholder=" " style="height:45px" class="did-floating-input"/>
                <label class="did-floating-label">Payment</label>
            </div>
            <span id="payment_err" class="error"></span>
        </div>

       </div>
    </div>
       {%endif%}

       <div class="">
           <div class="d-flex btndiv mt-5">
               <a href="{% url 'company:companyleads' %}" class="btn text-center cancelbtn">Cancel</a>
               <button class="text-center submitbtn" onclick="return formValidation();" type="submit">Update</button>
           </div>
       </div>
   </form>
       </div>
  
</main>
{% endblock %}{%block script%}{{block.super}}
  <!-- ==================================================================================================================================================== -->
<script src="{% static 'js/validation/validations.js'%}"></script>
<script>
    $(document).ready(function() {
   var table = $('#example1').DataTable();
  
});

// gst certificate btn
const realFileBtn = document.getElementById("gstcertificate");
  const customBtn = document.getElementById("fileName");
  const customTxt = document.getElementById("custom-text");
  
  customBtn.addEventListener("click", function() {
    realFileBtn.click();
  });
  
  realFileBtn.addEventListener("change", function() {
    if (realFileBtn.value) {
        $("#custom-text").show();
      customTxt.innerHTML = realFileBtn.value.match(
        /[\/\\]([\w\d\s\.\-\(\)]+)$/
      )[1];
    } else {
      customTxt.innerHTML = "No file chosen, yet.";
    }
  });
$('#gstcertificate').bind('change', function () {
  var filename = $("#gstcertificate").val();
  if (/^\s*$/.test(filename)) {
    $(".file-upload").removeClass('active');
    $("#noFile").text("No file chosen..."); 
  }
  else {
    $(".file-upload").addClass('active');
    $("#noFile").text(filename.replace("C:\\fakepath\\", "")); 
  }
});



//for company logo 
const reallogoFileBtn = document.getElementById("companylogos");
const customlogoBtn = document.getElementById("logofileName");
const logocustomTxt = document.getElementById("logocustom-text");

customlogoBtn.addEventListener("click", function() {
    reallogoFileBtn.click();
  });

  reallogoFileBtn.addEventListener("change", function() {
    if (reallogoFileBtn.value) {
        $("#logocustom-text").show();
      logocustomTxt.innerHTML = reallogoFileBtn.value.match(
        /[\/\\]([\w\d\s\.\-\(\)]+)$/
      )[1];
    } else {
        logocustomTxt.innerHTML = "No file chosen, yet.";
    }
  });


  $('#companylogos').bind('change', function () {
  var filename = $("#companylogos").val();
  if (/^\s*$/.test(filename)) {
    $(".file-upload").removeClass('active');
    $("#noFile").text("No file chosen..."); 
  }
  else {
    $(".file-upload").addClass('active');
    $("#noFile").text(filename.replace("C:\\fakepath\\", "")); 
  }
});


    // Name--------------------------------------------------------------------
    const Name = document.getElementById("companyname");
    Name.addEventListener("focus", function () {
        Name.setAttribute("placeholder", "Enter Company Name");
    });
    Name.addEventListener("blur", function () {
        Name.removeAttribute("placeholder");
    });

    //gst number-------------------------------------------------------------------
    const gst = document.getElementById("gstNumber");
    gst.addEventListener("focus", function () {
        gst.setAttribute("placeholder", "Enter GST Number");
    });
    gst.addEventListener("blur", function () {
        gst.removeAttribute("placeholder");
    });

    // Email--------------------------------------------------------------------------------
    const Email = document.getElementById("memberadmin");
    Email.addEventListener("focus", function () {
        Email.setAttribute("placeholder", "Enter Your Email");
    });
    Email.addEventListener("blur", function () {
        Email.removeAttribute("placeholder");
    });

    //Aadhaar number-------------------------------------------------------------------
    const aadhaar = document.getElementById("aadhaar");
    aadhaar.addEventListener("focus", function () {
        aadhaar.setAttribute("placeholder", "Enter Your Aadhaar Number");
    });
    aadhaar.addEventListener("blur", function () {
        aadhaar.removeAttribute("placeholder");
    });

    //Company Address-------------------------------------------------------------------
    const address = document.getElementById("caddress");
    address.addEventListener("focus", function () {
        address.setAttribute("placeholder", "Enter Address");
    });
    address.addEventListener("blur", function () {
        address.removeAttribute("placeholder");
    });

    //Aadhaar number-------------------------------------------------------------------
    const pancard = document.getElementById("panNumber");
    pancard.addEventListener("focus", function () {
        pancard.setAttribute("placeholder", "Enter Pan Number");
    });
    pancard.addEventListener("blur", function () {
        pancard.removeAttribute("placeholder");
    });

    //Dropdown------------------------------------------------------------------------------
     const Role = document.getElementById("role");
     Role.addEventListener("focus", function() {
       Role.setAttribute("placeholder", "Enter Your Role");
     });
     Role.addEventListener("blur", function() {
       Role.removeAttribute("placeholder");
     });

     //Payment-------------------------------------------------------------------
    const payment = document.getElementById("payment");
    payment.addEventListener("focus", function () {
        payment.setAttribute("placeholder", "Enter Value");
    });
    payment.addEventListener("blur", function () {
        payment.removeAttribute("placeholder");
    });
    //=========================================================================================
    function getamountbyperiod() {
        var period = $('#period').val();
        var html;
        $.ajax({
            type: "POST",
            url:frontendURL+"company/billingPeriodbyid",
            data: {
                'period': period,
                csrfmiddlewaretoken: '{{ csrf_token }}',
            },
            success: function (response) {         
                $("#payment").val(response.data.data.amount)
                
            }
        });
    }

    function formValidation(){
         
        var regex = /[A-Za-z0-9_~\-!@#\$%\^&\*\(\)]+$/;
        var companyname = $('#companyname').val().trim();   
        var memberadmin = $('#memberadmin').val().trim();   
        console.log("mm",memberadmin)
        var caddress = $('#caddress').val().trim();   
        var companyType = $('#companyType').val();   
        var gstNumber = $('#gstNumber').val();  
        var panNumber = $('#panNumber').val().trim();  
        var period =  $('#period').val(); 
        var payment = $('#payment').val(); 
      
        if (IsValid(companyname)) {
          $('#companyname_err').show().delay(3000).slideUp();
          $('#companyname_err').html('Company Name is required');
          $('#companyname').focus();
          return false;
        }else if (IsValid(memberadmin)) {
            $('#memberadmin_err').show().delay(3000).slideUp();
            $('#memberadmin_err').html('Admin Email is required');
            $('#memberadmin').focus();
            return false;
        }else if (!validateEmail(memberadmin)) {
            $('#memberadmin_err').show().delay(3000).slideUp();
            $('#memberadmin_err').html('Invalid Email');
            $('#memberadmin').focus();
            return false;
        }else if (IsValid(caddress)) {
            $('#caddress_err').show().delay(3000).slideUp();
            $('#caddress_err').html('Address field is required');
            $('#caddress').focus();
            return false;
        }else if (IsValid(companyType)) {
            $('#companyType_err').show().delay(3000).slideUp();
            $('#companyType_err').html('Please select company type');
            $('#companyType').focus();
            return false;
        }else if (IsValid(panNumber)) {
            $('#panNumber_err').show().delay(3000).slideUp();
            $('#panNumber_err').html('Please provide Pan card number');
            $('#panNumber').focus();
            return false;
        }
        else if (gstNumber != ""){
            if (IsValid(gstNumber)){
            $('#gstNumber_err').show().delay(3000).slideUp();
            $('#gstNumber_err').html('Gst Number field is required');
            $('#gstNumber').focus();
            return false;
          }else if(gstNumber.length != 15){
            $('#gstNumber_err').show().delay(3000).slideUp();
            $('#gstNumber_err').html('GST Number should be of 15 digits');
            $('#gstNumber').focus();
            return false;
          }else if (!validateGstNumber(gstNumber)) {
            $('#gstNumber_err').show().delay(3000).slideUp();
            $('#gstNumber_err').html('Invalid gstNumber');
            $('#gstNumber').focus();
            return false;
          }else if (IsValid(period)) {
            if (IsValid(payment)) {
            $('#payment_err').show().delay(3000).slideUp();
            $('#payment_err').html('Please provide payment');
            $('#payment').focus();
            return false;
            }
        }
        }
    
    } 
    </script>
    
    
{%endblock%}