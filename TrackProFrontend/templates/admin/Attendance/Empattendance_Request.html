{% extends "index.html" %}
{% load static %} 
{% load encryption_filters %}

{% block headercontent %}
Apply Attendance

{% endblock %}
{% block content %}

  <style>
    #pills-tab{
      border:none;
    }
    .add-btn {
    padding: 11px 20px 12px 20px !important;

}
#calendarIcon {
    height: 18px;
    width: 18px;
    position: absolute;
    background-image: url(./Media/Employee_Master/calendarLogo.svg);
    background-size: cover;
    right: 5%;
    top: 15%;
}
.dropdwn.show {
    display: flex;
    transform: translate(0px, 23px) !important;
}
      .image-list img:not(:first-child) {
          margin-left: -21.5px;
        }
        .image-list img:hover {
          transform: scale(1.5); /* Scale up on hover */
        }
        .image-list {
          display: flex;
          gap: 15px;
          margin:auto;
      }
    .buttons-excel  {
        background: transparent !important;
        border: none !important;
    }


    .input-feild {

        height: 48px;
    }

    #latemarktable>tbody>tr>td {
        padding: 15px !important;
    }
    table.dataTable thead th, table.dataTable tfoot th {
        font-weight: 500;
    }
    .dataTables_wrapper .dataTables_filter input {
        border: none;
        border-bottom: 1px solid #aaa;
        border-radius: 1px;

        outline: none;
    }
    .card-body-reason-text {
          font-size: 12px;
          color: #000000;
          padding-bottom: 10px 0px;
        }
        .card-header-txt {
        font-size: 12px;
        }
        .card-header-title {
          font-size: 12px;
          font-weight: 500;
        }
        .card-header-blue-txt{
          color: #00AEEF;
          font-size: 16px;
          font-weight: 500;
        }
        .conclusion-box{
          border-radius: 12px;
        
          background-color: #ECF1F2;
          color: #403f3f;
        }
       
        .manager-profile-picture-rejected {
          height: 25px;
          width: 25px;
          border-radius: 50%;
          position: relative;
          z-index: 10 !important;
        }
        .card-header-name-txt {
          color: #403f3f;
          font-size: 18px;
          padding-bottom: 16px;
        }
        .card-body-comment-text {
          font-size: 12px;
          height: 18px;
          padding-bottom: 10px 0px;
        }
        .card-header {
        padding: 0.5rem 1rem;
        margin-bottom: 0;
        background-color:white; 
        border-bottom: none;
        color: #403f3f;
      }
      .card-body {
    padding-top: 0px;
    padding-bottom: 0px;
}
      .card{
        border-radius: 6px;
        background: #FFF;
        box-shadow: 0px 4px 8px #00000029;
      }
      .manager-pic {
        cursor: pointer;
        height: 25px;
        width: 25px;
        border-radius: 50%;
    }
    .manager-pic-Pending{
          border: 1px solid orange;
        }
        .manager-pic-Approved{
          border: 1px solid green;
        }
        .manager-pic-Rejected{
          border: 1px solid red;
        }
        .cardfooter{
          background: white;
          border: none;
        }
        .managers-imgs{
          text-align: right;
          padding: 4px 30px 4px 0;
        }
        
</style>
  <!-- Include jQuery UI Datepicker library -->

  <main class="main-wrapper">
    {% if messages %}
    <div class="row" style="justify-content: center;">
      <div class="col-sm-6 col-sm-offset-3">
        {% for message in messages %}
        <div style="display: flex; margin: 15px 0px;flex-direction: row-reverse;justify-content: center;align-items: center;" class="alert-meaasge alert alert-{{ message.tags }} alert-dismissible text-center" role="alert">
          <button type="button" class="close" data-dismiss="alert" aria-label="Close" style="background: transparent; border: none; font-size: 25px; color: #ff0000;">
            <span aria-hidden="true">&times;</span>
          </button>
          <p style="margin-bottom: 0px;">{{ message }}</p>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}
    
    
    
 

  
    <div class="leads-div">
        <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
       
            <li class="nav-item p-0 m-0" role="presentation">
              <button class="nav-link active" id="pills-pending-tab" data-bs-toggle="pill" data-bs-target="#pills-pending" type="button" role="tab" aria-controls="pills-pending" aria-selected="true">Pending Requests</button>
            </li>
    
            <li class="nav-item p-0 m-0" role="presentation">
              <button class="nav-link" id="pills-approved-tab" data-bs-toggle="pill" data-bs-target="#pills-approved" type="button" role="tab" aria-controls="pills-approved" aria-selected="false">Approved Requests</button>
            </li>
            <li class="nav-item p-0 m-0" role="presentation">
              <button class="nav-link" id="pills-rejected-tab" data-bs-toggle="pill" data-bs-target="#pills-rejected" type="button" role="tab" aria-controls="pills-rejected" aria-selected="false">Rejected Requests</button>
            </li>
            <li class="nav-item p-0 m-0" role="presentation">
                <button class="nav-link" id="pills-cancelled-tab" data-bs-toggle="pill" data-bs-target="#pills-cancel" type="button" role="tab" aria-controls="pills-cancel" aria-selected="false">Cancelled Requests</button>
              </li>
        </ul>
      
        <div class="tab-content" id="pills-tabContent">
            <!-- 1st-Pane -->
            <div class="tab-pane fade show active" id="pills-pending" role="tabpanel" aria-labelledby="pills-pending-tab" tabindex="0">
                
              <div class="row" id="pendingleaves">
                {% for i in Pendingrequests %}
                  <div class="col-lg-4 col-md-6 col-sm-12 mt-4">
                      <div id="card" class="card text-start h-100">
                        <div class="card-header d-flex justify-content-between pb-0 col-lg-12 card-header-name-txt">
                          <span class="card-header-blue-txt text-black">{{i.Username}}</span>
                          <span>
                            <div class="dropdown">

                              <span class="dropdown-toggle" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">
                                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="29" viewBox="0 0 28 29" fill="none">
                                  <path d="M13.9955 23.8334C13.6093 23.8334 13.2802 23.6959 13.0079 23.4209C12.7357 23.146 12.5996 22.8154 12.5996 22.4293C12.5996 22.0431 12.7371 21.714 13.0121 21.4417C13.287 21.1695 13.6176 21.0334 14.0038 21.0334C14.3899 21.0334 14.7191 21.1709 14.9913 21.4459C15.2635 21.7209 15.3996 22.0514 15.3996 22.4376C15.3996 22.8237 15.2621 23.1529 14.9871 23.4251C14.7122 23.6973 14.3816 23.8334 13.9955 23.8334ZM13.9955 15.9001C13.6093 15.9001 13.2802 15.7626 13.0079 15.4876C12.7357 15.2126 12.5996 14.8821 12.5996 14.4959C12.5996 14.1098 12.7371 13.7806 13.0121 13.5084C13.287 13.2362 13.6176 13.1001 14.0038 13.1001C14.3899 13.1001 14.7191 13.2376 14.9913 13.5126C15.2635 13.7875 15.3996 14.1181 15.3996 14.5042C15.3996 14.8904 15.2621 15.2195 14.9871 15.4917C14.7122 15.764 14.3816 15.9001 13.9955 15.9001ZM13.9955 7.96675C13.6093 7.96675 13.2802 7.82926 13.0079 7.55427C12.7357 7.27931 12.5996 6.94875 12.5996 6.56261C12.5996 6.17648 12.7371 5.8473 13.0121 5.57508C13.287 5.30286 13.6176 5.16675 14.0038 5.16675C14.3899 5.16675 14.7191 5.30424 14.9913 5.57922C15.2635 5.85419 15.3996 6.18474 15.3996 6.57089C15.3996 6.95702 15.2621 7.28619 14.9871 7.55841C14.7122 7.83064 14.3816 7.96675 13.9955 7.96675Z" fill="#8F9597"/>
                                </svg>
                              </span>


                                <ul class="dropdown-menu dropdwn" aria-labelledby="dropdownMenuButton1">


                                  <li>
                                      <a class="dropdown-item" href =""  title="Edit" data-bs-toggle="modal" data-bs-target="#editmodal{{i.id}}"><i class="fa fa-pencil-square-o text-primary"  aria-hidden="true"></i> </a>
                                  </li>
                                 
                                  <li>
                                      <a class="dropdown-item" href=""  title="Cancel" data-bs-toggle="modal" data-bs-target="#Cancelmodal{{i.id}}"><i class="fa fa-solid fa-rotate-left text-warning" aria-hidden="true"></i></a>
                                
                                  </li>



                             

                              </ul>
                            </div>
                        </span>
                        </div>
                        <div class="card-header head d-flex justify-content-between align-items-center">
                            <span>                                   
                                <span class="card-header-txt">Date </span><br>
                                <!-- <span class="card-header-blue-txt">{{i.newdate }}</span>  -->
                                <span class="card-header-blue-txt">{{i.requestdate }}</span> 

                            </span>
                            <span>                                   
                              <span class="card-header-txt">CheckIn Time </span><br>
                              <span class="card-header-blue-txt" title="{{i.UserCheckInTime }}">{{i.UserCheckInTime }}</span> 
                          </span>
                            <span class="d-flex justify-content-between">
                              <span class="text-center">                                   
                                <span class="card-header-txt">CheckOut Time </span><br>
                                <span class="card-header-blue-txt" title="{{i.UserCheckOutTime }}">{{i.UserCheckOutTime }}</span> 
                              </span>
                              <span>
  
                              </span>
                            </span>
                        </div>
  
                        <div class="card-body">
                            <div class="row">
                              <div class="col-lg-12">
                                <div class="card-header p-0">
                                <span class="card-header-txt">Reason :</span><br>
                                <span  class="my-3 card-body-reason-text addReadMore showlesscontent" data-bs-toggle="tooltip" data-bs-placement="bottom"  title="{{i.reason}}">{{i.Reason}}</span>
                                </div>
                              </div>
                            </div>
                        </div>
  
                        <div class="card-footer cardfooter mt-auto">
                          <div class="row">
                            <div class="col-lg-12 conclusion-box my-2">
                              <div  class="py-2 row">
                                <span class="image-list card-header-txt py-1 pe-0 col-lg-8 col-md-6 col-sm-12" style="display: flex; align-items: center;">
                                 
                                  <span class="ps-1">This application is pending.</span>
                                </span>  
                                <span class="image-list d-flex justify-content-end managers-imgs col-lg-4 col-md-6 col-sm-12">
                                
                                  {%for manager in i.managerlist %}
                                 
                                      <img  class="manager-pic manager-pic-Pending"  src="{{manager.managerpic}}" data-bs-toggle="tooltip" data-bs-placement="top" title="⏳ {{manager.managername}} " />
                                  {%endfor%}
  
                                </span>
                              </div>
                            </div>
                          </div>
  
  
                        
                        </div>
  
  
                      </div>
  
  
                  </div>
  
  
                {%empty%}
                  <div class="noappdiv">
                    <div class="text-center py-4 ">No Applications Recieved!</div>
                  </div>
                {%endfor%}
  
              </div>
                
            </div>

              <!-- 2nd-Pane -->
              <div class="tab-pane fade" id="pills-approved" role="tabpanel" aria-labelledby="pills-approved-tab" tabindex="0">
                
                <div class="row" id="approvedleaves">
                  {% for i in Approverequests%}
                    <div class="col-lg-4 col-md-6 col-sm-12 mt-4">
                        <div id="card" class="card text-start h-100">
                          <div class="card-header d-flex justify-content-between pb-0 col-lg-12 card-header-name-txt">
                            <span class="card-header-blue-txt text-black">{{i.Username}}</span>
                          </div>
                          <div class="card-header head d-flex justify-content-between align-items-center">
                            <span>                                   
                              <span class="card-header-txt">Date </span><br>
                              <!-- <span class="card-header-blue-txt">{{i.newdate }}</span>  -->
                              <span class="card-header-blue-txt">{{i.requestdate }}</span> 
                          </span>
                          <span>                                   
                            <span class="card-header-txt">CheckIn Time </span><br>
                                <span class="card-header-blue-txt" title="{{i.UserCheckInTime }}">{{i.UserCheckInTime }}</span> 
                          </span>
                              <span class="d-flex justify-content-between">
                                <span class="text-center">                                   
                                  <span class="card-header-txt">CheckOut Time </span><br>
                                  <span class="card-header-blue-txt" title="{{i.UserCheckOutTime }}">{{i.UserCheckOutTime }}</span> 
                                </span>
                                <span>
    
                                </span>
                              </span>
                          </div>
    
                          <div class="card-body">
                              <div class="row">
                                <div class="col-lg-12">
                                  <div class="card-header p-0">
                                  <span class="card-header-txt">Reason :</span><br>
                                  <span  class="my-3 card-body-reason-text addReadMore showlesscontent" data-bs-toggle="tooltip" data-bs-placement="bottom"  title="{{i.reason}}">{{i.Reason}}</span>
                                  </div>
                                </div>
                              </div>
                          </div>
    
                          <div class="card-footer cardfooter mt-auto">
                            <div class="row">
                              <div class="col-lg-12 conclusion-box my-2">
                                <div  class="py-2 row">
                                  <span class="image-list card-header-txt py-1 pe-0 col-lg-8 col-md-6 col-sm-12" style="display: flex; align-items: center;">
                                    {%for manager in i.managerlist %}
                                    {%if manager.actiontaken == True%} 
                                    
                                    
                                        <img  class="manager-pic manager-pic-Approved" src="{{manager.managerpic}}" data-bs-placement="top" data-bs-toggle="tooltip" title="✅ {{manager.managername}} " />
                                     
                
          
                                    {%endif%}
                
                                    {%endfor%}
                                    <span class="ps-1">This application is approved.</span>
                                  </span>   
                                  <span class="image-list d-flex justify-content-end managers-imgs col-lg-4 col-md-6 col-sm-12">
                                    {%for manager in i.managerlist %}
                                    {%if manager.actiontaken == False%}
                                     
                                        <img  class="manager-pic manager-pic-Pending"  src="{{manager.managerpic}}" data-bs-toggle="tooltip" data-bs-placement="top" title="⏳ {{manager.managername}} " />
                                      
                                      {%endif%}
                                    {%endfor%}
    
                                  </span>
                                </div>
                              </div>
                            </div>
    
    
                          </div>
    
    
                        </div>
    
    
                    </div>
    
    
                  {%empty%}
                    <div class="noappdiv">
                      <div class="text-center py-4 ">No Applications Recieved!</div>
                    </div>
                  {%endfor%}
    
                </div>
                  
              </div>

              <!---3rd pane-->
              <div class="tab-pane fade" id="pills-rejected" role="tabpanel" aria-labelledby="pills-rejected-tab" tabindex="0">
                
                <div class="row" id="approvedleaves">
                  {% for i in Rejectedrequests%}
                    <div class="col-lg-4 col-md-6 col-sm-12 mt-4">
                        <div id="card" class="card text-start h-100">
                          <div class="card-header d-flex justify-content-between pb-0 col-lg-12 card-header-name-txt">
                            <span class="card-header-blue-txt text-black">{{i.Username}}</span>
                          </div>
                          <div class="card-header head d-flex justify-content-between align-items-center">
                            <span>                                   
                              <span class="card-header-txt">Date </span><br>
                              <!-- <span class="card-header-blue-txt">{{i.newdate }}</span>  -->
                              <span class="card-header-blue-txt">{{i.requestdate }}</span> 
                          </span>
                          <span>                                   
                            <span class="card-header-txt">CheckIn Time </span><br>
                                <span class="card-header-blue-txt" title="{{i.UserCheckInTime }}">{{i.UserCheckInTime }}</span> 
                        </span>
                              <span class="d-flex justify-content-between">
                                <span class="text-center">                                   
                                  <span class="card-header-txt">CheckOut Time </span><br>
                                  <span class="card-header-blue-txt" title="{{i.UserCheckOutTime }}">{{i.UserCheckOutTime }}</span> 
                                </span>
                                <span>
    
                                </span>
                              </span>
                          </div>
    
                          <div class="card-body">
                              <div class="row">
                                <div class="col-lg-12">
                                  <div class="card-header p-0">
                                  <span class="card-header-txt">Reason :</span><br>
                                  <span  class="my-3 card-body-reason-text addReadMore showlesscontent" data-bs-toggle="tooltip" data-bs-placement="bottom"  title="{{i.reason}}">{{i.Reason}}</span>
                                  </div>
                                </div>
                              </div>
                          </div>
    
                          <div class="card-footer cardfooter mt-auto">
                            <div class="row">
                              <div class="col-lg-12 conclusion-box my-2">
                                <div  class="py-2 row">
                                  <span class="image-list card-header-txt py-1 pe-0 col-lg-8 col-md-6 col-sm-12" style="display: flex; align-items: center;">
                                    {%for manager in i.managerlist %}
                                    {%if manager.actiontaken == True%}
                                     
                                        <img  class="manager-pic manager-pic-Rejected" src="{{manager.managerpic}}" data-bs-placement="top" data-bs-toggle="tooltip" title="❌  {{manager.managername}} " />
                                     
                                    
                
          
                                    {%endif%}
                
                                    {%endfor%}
                                    <span class="ps-1">This application is Rejected.</span>
                                  </span>   
                                  <span class="image-list d-flex justify-content-end managers-imgs col-lg-4 col-md-6 col-sm-12">
                                    {%for manager in i.managerlist %}
                                    {%if manager.actiontaken == False%}
                                     
                                        <img  class="manager-pic manager-pic-Pending"  src="{{manager.managerpic}}" data-bs-toggle="tooltip" data-bs-placement="top" title="⏳ {{manager.managername}} " />
                                     
                                      {%endif%}
                                    {%endfor%}
    
                                  </span>
                                </div>
                              </div>
                            </div>
    
    
                          </div>
    
    
                        </div>
    
    
                    </div>
    
    
                  {%empty%}
                    <div class="noappdiv">
                      <div class="text-center py-4 ">No Applications Recieved!</div>
                    </div>
                  {%endfor%}
    
                </div>
                  
              </div>

              <!---4th pane-->
              <div class="tab-pane fade" id="pills-cancel" role="tabpanel" aria-labelledby="pills-cancelled-tab" tabindex="0">
                
                <div class="row" id="approvedleaves">
                  {% for i in Cancelledrequests%}
                    <div class="col-lg-4 col-md-6 col-sm-12 mt-4">
                        <div id="card" class="card text-start h-100">
                          <div class="card-header d-flex justify-content-between pb-0 col-lg-12 card-header-name-txt">
                            <span class="card-header-blue-txt text-black">{{i.Username}}</span>
                          </div>
                          <div class="card-header head d-flex justify-content-between align-items-center">
                            <span>                                   
                              <span class="card-header-txt">Date </span><br>
                              <!-- <span class="card-header-blue-txt">{{i.newdate }}</span>  -->
                              <span class="card-header-blue-txt">{{i.requestdate }}</span> 
                          </span>
                          <span>                                   
                            <span class="card-header-txt">CheckIn Time </span><br>
                                <span class="card-header-blue-txt" title="{{i.UserCheckInTime }}">{{i.UserCheckInTime }}</span> 
                          </span>
                              <span class="d-flex justify-content-between">
                                <span class="text-center">                                   
                                  <span class="card-header-txt">CheckOut Time </span><br>
                                  <span class="card-header-blue-txt" title="{{i.UserCheckOutTime }}">{{i.UserCheckOutTime }}</span> 
                                </span>
                                <span>
    
                                </span>
                              </span>
                          </div>
    
                          <div class="card-body">
                              <div class="row">
                                <div class="col-lg-12">
                                  <div class="card-header p-0">
                                  <span class="card-header-txt">Reason :</span><br>
                                  <span  class="my-3 card-body-reason-text addReadMore showlesscontent" data-bs-toggle="tooltip" data-bs-placement="bottom"  title="{{i.reason}}">{{i.Reason}}</span>
                                  </div>
                                </div>
                              </div>
                          </div>
    
                          <div class="card-footer cardfooter mt-auto">
                            <div class="row">
                              <div class="col-lg-12 conclusion-box my-2">
                                <div  class="py-2 row">
                                  <span class="image-list card-header-txt py-1 pe-0 col-lg-8 col-md-6 col-sm-12" style="display: flex; align-items: center;">
                                    {%for manager in i.managerlist %}
                                    {%if manager.actiontaken == True%}
                                     
                                        <img  class="manager-pic manager-pic-Rejected" src="{{manager.managerpic}}" data-bs-placement="top" data-bs-toggle="tooltip" title="❌  {{manager.managername}} " />
                                     
                                    {%endif%}
                
                                    {%endfor%}
                                    <span class="ps-1">This application is Cancelled.</span>
                                  </span>   
                                  <span class="image-list d-flex justify-content-end managers-imgs col-lg-4 col-md-6 col-sm-12">
                                    {%for manager in i.managerlist %}
                                    {%if manager.actiontaken == False%}
                                     
                                        <img  class="manager-pic manager-pic-Pending"  src="{{manager.managerpic}}" data-bs-toggle="tooltip" data-bs-placement="top" title="⏳ {{manager.managername}} " />
                                     
                                      {%endif%}
                                    {%endfor%}
    
                                  </span>
                                </div>
                              </div>
                            </div>
    
    
                          </div>
    
    
                        </div>
    
    
                    </div>
    
    
                  {%empty%}
                    <div class="noappdiv">
                      <div class="text-center py-4 ">No Applications Recieved!</div>
                    </div>
                  {%endfor%}
    
                </div>
                  
              </div>

    </div>
    </div>

    {% for i in Pendingrequests %}
    <div class="modal fade" id="Cancelmodal{{i.id}}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered w-25">
      
        <div class="modal-content">           
          <div class="modal-header ps-3 text-center">
            <h5 class="modal-title py-2" id="exampleModalLabel">Cancel Application</h5>
          </div>
          <div class="modal-body">
            
            <div class="row">
              <div> Are you sure you want to Cancel this application?

              </div>
            </div>
          
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-gradient-danger btn-rounded btn-fw" data-bs-dismiss="modal">No</button>
            <button onclick="Cancelrequest('{{i.id}}')" data-bs-dismiss="modal" class="btn btn-gradient-info btn-rounded btn-fw" data-bs-dismiss="modal" id="addEmployeeBtn">Yes</button>
          </div>
        </div>
      </div>
    </div>
    {%endfor%}


  {% for i in Pendingrequests %}
  <div class="modal fade" id="editmodal{{i.id}}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content">           
        <div class="modal-header ps-4">
          <h5 class="modal-title py-2" id="exampleModalLabel">Update Request</h5>
        </div>
        <div class="modal-body">
          <div class="row">
            <div class="col-12 px-4">
              <label for="reason">Reason </label>
              <textarea class="form-control" rows="5" id="reason{{i.id}}" name="reason" >{{i.Reason}}</textarea >
                <span id="reasonerror{{i.id}}" class="error-message"></span>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <div class="w-50 justify-content-center">
            <button type="button" class="btn btn-gradient-danger btn-rounded btn-fw" data-bs-dismiss="modal">Close</button>
            <button type="submit" class="Role-btn" id="addEmployeeBtn" onclick="updaterequest('{{i.id}}')">Update</button>
          </div>
        </div>
      </div>
    </div>
  </div>
{%endfor%}



<div class="modal fade" id="AddnewRequest" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">           
      <div class="modal-header ps-4">
        <h5 class="modal-title py-2" id="exampleModalLabel">Request for Attendance</h5>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-12 px-4">
            <label for="request_date">Select Date</label>
            <input type="text" id="request_date" placeholder="Select Date" name="" autocomplete="off">
            <span class="error" id="request_dateerror"></span>
            <div id="calendarIcon"></div> 
          </div>
          <div class="col-12 px-4">
            <label for="request_reason">Reason </label>
            <textarea class="form-control" rows="5" id="request_reason" name="request_reason"></textarea >
              <span id="request_reasonerror" class="error"></span>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <div class="w-50 justify-content-center">
          <button type="button" class="btn btn-gradient-danger btn-rounded btn-fw" data-bs-dismiss="modal">Close</button>
          <button type="submit" class="Role-btn" id="addEmployeeBtn" onclick="Addrequest('{{i.id}}')">Apply</button>
        </div>
      </div>
    </div>
  </div>
</div>


</main>
{% endblock %}
{% block indexaddbuttons %}

<li><a data-bs-toggle="modal" data-bs-target="#AddnewRequest">
  <img id="icon" class="floatingimg" data-bs-toggle="tooltip" data-bs-placement="left" title="Request Attendance"
  src="{% static 'assets/svg/departmentmastericon.svg' %}">
</a></li>
 {% endblock %}
{% block script %}
{{block.super}}
  <script type="text/javascript">

  $(document).ready(function () {
    $("#request_date").datepicker({ 
          dateFormat: 'dd-mm-yy',
          minDate: -7,
          maxDate: 0
        });
  })


 function Addrequest(){
  var requestreason = $('#request_reason').val()
  var requestdate = $('#request_date').val()
    if (IsValid(requestdate)) {
        $('#request_dateerror').show().delay(3000).slideUp();
        $('#request_dateerror').html('Date for request is required');
        $('#request_date').focus();
        return false;
    } 
    if (IsValid(requestreason)) {
        $('#request_reasonerror').show().delay(3000).slideUp();
        $('#request_reasonerror').html('reason for request is required');
        $('#request_reason').focus();
        return false;
    }
      else{
      $.ajax( {
        url: frontendURL +"Attendancerequest",
        type: 'POST',
        data:{
          csrfmiddlewaretoken:'{{ csrf_token }}',
          'requestdate':requestdate,
          'reason':requestreason,
          },
        dataType: 'json',
      
        success: function(response){
        
          console.log("attresp",response)
          if (response['response']['n'] == 1){
             swal({
              icon: "success",
              title: "",
              text: response['response']['msg'],
              button: "Close",
              })
            location.reload()
            }
          else{
            swal({
              icon: "error",
              title: "",
              text: response['response']['msg'],
              button: "Close",
              })
          }
          
        }
      });
    }
 }


 function Cancelrequest(id){
  $.ajax( {
    url: frontendURL +"cancelattendaancerequest",
    type: 'POST',
    data:{
      csrfmiddlewaretoken:'{{ csrf_token }}',
      'request_id':id ,    
      },
    dataType: 'json',
    success: function(response){
      console.log("respo app",response)
      if (response['response']['n'] == 1){
        swal({
              icon: "success",
              title: "",
              text: response['response']['msg'],
              button: "Close",
              })
              location.reload();
            }
      else{
        swal({
              icon: "error",
              title: "",
              text: response['response']['msg'],
              button: "Close",
              }).then(() => {
                // Code to execute after the user closes the SweetAlert dialog
               location.reload(); // Reload the page
              });
      }


      
      
    }
  });

}


function updaterequest(id){
    var reason = $('#reason'+id).val()
    if (IsValid(reason)) {
        $('#reasonerror').show().delay(3000).slideUp();
        $('#reasonerror').html('reason for request is required');
        $('#reason').focus();
        return false;
    } 
      else{
      $.ajax( {
        url: frontendURL +"Employeerequest",
        type: 'POST',
        data:{
          csrfmiddlewaretoken:'{{ csrf_token }}',
          'request_id':id,
          'Reason':reason,
          },
        dataType: 'json',
      
        success: function(response){
        
          console.log("respo",response)
          if (response['response']['n'] == 1){
          
            swal({
              icon: "success",
              title: "",
              text: response['response']['msg'],
              button: "Close",
              })
              location.reload();  
          }
                
          else{
            swal({
              icon: "error",
              title: "",
              text: response['response']['msg'],
              button: "Close",
              })
          }   
          
        }
      });
    }
    }
  
 
  </script>
{% endblock %}
