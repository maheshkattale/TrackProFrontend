<!DOCTYPE html>
<html lang="en">
  <head>
    {%load static %}
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TrackPro-Managetask</title>
    <!-- 1.Owl carousel min.js -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css"
      integrity="sha512-tS3S5qG0BlhnQROyJXvNjeEM4UpMXHrQfTGmbQ1gKmelCxlSEBUaxhRBj/EFTzpbP4RVSrpEikbmdJobCvhE3g=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />

    <!-- 2.Owl carousel Theme min.css -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.theme.default.min.css"
      integrity="sha512-sMXtMNL1zRzolHYKEujM2AqCLUR9F2C4/05cdbxjjLSRvMQIciEPCQZo++nk7go3BtSuK9kfa/s+a4f4i5pLkw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi"
      crossorigin="anonymous"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="{% static 'admin/dashboard/dashboard.css' %}" />

    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css"
    />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.2.228/pdf.min.js"></script>
   
    <link rel="stylesheet" href="{% static 'assets/css/style2.css'%}" />
    <link rel="stylesheet" href="{% static 'admin/sweetalert.css'%}">
    <style>
     .skipbtn {
    /* width: 20%; */
    /* padding: 0.4rem; */
    display: block;
    text-decoration: none;
    background-color: rgb(197, 192, 192);
    color: #f3f3f3;
    text-align: center;
    cursor: pointer;
    transition: 0.3s;
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    /* font-weight: 500; */
}
.skipbtn:hover{
  background-color: rgb(197, 192, 192);
    color: #f3f3f3;
}
    </style>
  </head>

  <body>
   <!-- ==================Navbar(Header)======================= -->
   <header>
    <nav class="navbar navbar-expand-lg navbar-dark gradient-custom fixed-top">
      <div class="container-fluid">
        <!-- <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarTogglerDemo03" aria-controls="navbarTogglerDemo03" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button> -->
        <div class="collapse navbar-collapse" id="navbarTogglerDemo03">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
           
            <li class="nav-item">
              {%if companylogo is None %}
              <img class="img" src="{% static 'assets\images\zentro_logo.jpeg'%}" alt="">
              {%else%}
              <img class="img" src="{{ImageURL}}/media/{{companylogo}}" alt="No logo">
              {%endif%}
            </li>
          </ul>
          <div class="me-2 navdropdown" >
           
            <div class="dropdown dropleft">
            <a class="dropdown-toggle"  data-bs-toggle="dropdown">
              <i class="fa fa-user" style="color:#00aeef;"></i></a>
                 
            <ul class="dropdown-menu index-dropdown" >
              <li><a class="dropdown-item" href="{% url 'users:logout' %}">
                <img id="icon" class="drpdwnimg" width="15%" src="{% static 'assets/icons/logout.png' %}">Logout</a>
                <div class="text-center ">({{Firstname}} {{Lastname}})</div>
              </li>
            </ul>
           
          </div>
        </div>
        </div>
      </div>
    </nav>

    
    <!-- Navbar -->
   
  </header>

 
    <!-- Main page -> Manage Task -->
    <main class="add-main-wrapper">
      <!-- ==================Row1======================= -->
      <div class="email-box-section">
         <form action="#" class="form">
          <!-- Progress bar -->
          <div class="progressbar">
            <div class="progress" id="progress"></div>
            <div class="progress-step progress-step-active" data-title="Designation Master">
                <i class="fa-solid fa-person"></i>
            </div>
            <div class="progress-step" data-title="Department Master" id="departmentmaster">
                <i class="fa-solid fa-building"></i>
            </div>
            <div class="progress-step" data-title="Location Master" id="locationmaster">
                <i class="fa-solid fa-location-arrow"></i>
            </div>
            <div class="progress-step" data-title="Employee Master" id="employeemaster">
                <i class="fa-solid fa-person"></i>
              </div>
          </div>
          
          <!-- Steps -->
          <div class="form-step form-step-active" id="form-designation">
            <div class="row">
              <!-- <div class="mt-3 text-center">
                <button id="button" >Upload Excel Sheet</button>
              </div> -->
         
            <!-- <div class="file-button-wrap">
            
              <label class="filebutton" for="fileupload">  <span class="me-1"><i class="fa fa-download"></i></span>Upload Excel File</label>
              <input id="fileupload" type="file" name="panFile">
              <div class="image-preview1" id="imagePreview1">
            
              </div>
            </div> -->
            <div class="d-flex justify-content-center">
            <div class="file-upload-box">
           <div class="file-upload-btn">
              <input id="designationfile"  type="file" hidden="hidden">
              <button type="button" id="designationfile-custom-button">Upload Excel File</button>
              <p id="designationfile-custom-text">No File chosen,yet.<a class="text-primary cursor-pointer" href="{% static 'Media/SampleExcels/designation.xlsx'%}" download>Download Excel</a>
              </p>
          </div>
          </div>
        </div>
        
            </div>
            <div class="d-flex justify-content-end my-3">
              <a onclick="skipdesignation();"href="javascript:void(0);" class="skipbtn btn-next me-1">Skip and continue</a>
              <a onclick="uploaddesignation();"href="javascript:void(0);" class="wizardbtn btn-next">Save and continue</a>
            </div>
          </div>
          
          <div class="form-step" id="form-department">
            <div class="row">
              <div class="d-flex justify-content-center">
                <div class="file-upload-box">
               <div class="file-upload-btn">
                  <input id="departmentfile" type="file" hidden="hidden">
                  <button type="button" id="departmentfile-custom-button">Upload Excel File</button>
                  <p id="departmentfile-custom-text">No File chosen,yet.<a class="text-primary cursor-pointer" href="{% static 'Media/SampleExcels/department.xlsx'%}" download>Download Excel</a></p>
              </div>
              </div>
            </div>
            </div>
            <div class="d-flex justify-content-end my-3">
              <a onclick="skipdepartment();" href="javascript:void(0);" class="skipbtn btn-next me-1">Skip and continue</a>
              <a onclick="uploaddepartment();" href="javascript:void(0);" class="wizardbtn btn-next">Save and continue</a>
            </div>
          </div>
          <div class="form-step" id="form-location">
            <div class="row">
              <div class="d-flex justify-content-center">
                <div class="file-upload-box">
               <div class="file-upload-btn">
                  <input id="locationfile" type="file" hidden="hidden">
                  <button type="button" id="locationfile-custom-button">Upload Excel File</button>
                  <p id="locationfile-custom-text">No File chosen,yet. <a class="text-primary cursor-pointer" href="{% static 'Media/SampleExcels/location.xlsx'%}" download>Download Excel</a></p>
              </div>
              </div>
            </div>
            </div>
            <div class="d-flex justify-content-end my-3">
              <a onclick="skiplocation();" href="javascript:void(0);" class="skipbtn btn-next me-1">Skip and continue</a>
                <a onclick="uploadlocation();" href="javascript:viod(0);" class="wizardbtn btn-next">Save and continue</a>
              </div>
          </div>
          <div class="form-step" id="form-employee">
            <div class="row">
              <div class="d-flex justify-content-center">
                <div class="file-upload-box">
               <div class="file-upload-btn">
                  <input id="employeefile" type="file" hidden="hidden">
                  <button type="button" id="employeefile-custom-button">Upload Excel File</button>
                  <p id="employeefile-custom-text">No File chosen,yet.<a class="text-primary cursor-pointer" href="{% static 'Media/SampleExcels/employee.xlsx'%}" download>Download Excel</a></p>
              </div>
              </div>
            </div>
            </div>
            <div class="d-flex justify-content-end mb-3">
                <div class="d-flex justify-content-end mb-3">
                    <span onclick="uploademployee();" class="wizardbtn" >Save</span>
                  </div>
            </div>
          </div>
        </form>
      </div>
    </main>
    
    <script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
      crossorigin="anonymous"
    ></script>

    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
      integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p"
      crossorigin="anonymous"
    ></script>
    <script src="{% static 'js/sweetalert.js'%}"></script>
   
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/4.4.0/bootbox.min.js"></script>
    <script>




      $(document).ready(function () {
        $('#downloadButton').on('click', function () {
            // Assuming your Excel file is in the same directory as this HTML file
            var filePath = "{% static 'Media/SampleExcels/designation.xlsx'%}";

            // Create a new Blob with the Excel file content
            $.get(filePath, function (data) {
                var blob = new Blob([data]);

                // Create a download link
                var downloadLink = $('<a></a>');
                downloadLink.attr('href', URL.createObjectURL(blob));
                downloadLink.attr('download', 'designation.xlsx');

                // Append the link to the body and trigger a click event
                $('body').append(downloadLink);
                downloadLink[0].click();

                // Remove the link from the body
                downloadLink.remove();
            });
        });



        $('#downloaddepartment').on('click', function () {
          // Assuming your Excel file is in the same directory as this HTML file
          var filePath = "{% static 'Media/SampleExcels/department.xlsx'%}";

          // Create a new Blob with the Excel file content
          $.get(filePath, function (data) {
              var blob = new Blob([data]);

              // Create a download link
              var downloadLink = $('<a></a>');
              downloadLink.attr('href', URL.createObjectURL(blob));
              downloadLink.attr('download', 'department.xlsx');

              // Append the link to the body and trigger a click event
              $('body').append(downloadLink);
              downloadLink[0].click();

              // Remove the link from the body
              downloadLink.remove();
            });
        });


        $('#downloadlocation').on('click', function () {
          // Assuming your Excel file is in the same directory as this HTML file
          var filePath = "{% static 'Media/SampleExcels/location.xlsx'%}";

          // Create a new Blob with the Excel file content
          $.get(filePath, function (data) {
              var blob = new Blob([data]);

              // Create a download link
              var downloadLink = $('<a></a>');
              downloadLink.attr('href', URL.createObjectURL(blob));
              downloadLink.attr('download', 'location.xlsx');

              // Append the link to the body and trigger a click event
              $('body').append(downloadLink);
              downloadLink[0].click();

              // Remove the link from the body
              downloadLink.remove();
          });
        });
        



        $('#downloademployee').on('click', function () {
          // Assuming your Excel file is in the same directory as this HTML file
          var filePath = "{% static 'Media/SampleExcels/employee.xlsx'%}";

          // Create a new Blob with the Excel file content
          $.get(filePath, function (data) {
              var blob = new Blob([data]);

              // Create a download link
              var downloadLink = $('<a></a>');
              downloadLink.attr('href', URL.createObjectURL(blob));
              downloadLink.attr('download', 'employee.xlsx');

              // Append the link to the body and trigger a click event
              $('body').append(downloadLink);
              downloadLink[0].click();

              // Remove the link from the body
              downloadLink.remove();
          });
        });


    });
      var frontendURL = '{{basefrontendUrl}}'

      const realFilebtndesign = document.getElementById("designationfile");
      const realFilebtndepart = document.getElementById("departmentfile");
      const realFilebtnlocation = document.getElementById("locationfile");
      const realFilebtnemployee = document.getElementById("employeefile");
      const custombtndesign = document.getElementById("designationfile-custom-button");
      const custombtndepart = document.getElementById("departmentfile-custom-button");
      const custombtnlocation = document.getElementById("locationfile-custom-button");
      const custombtnemployee = document.getElementById("employeefile-custom-button");
      const customtxtdesign = document.getElementById("designationfile-custom-text");
      const customtxtdepart = document.getElementById("departmentfile-custom-text");
      const customtxtlocation = document.getElementById("locationfile-custom-text");
      const customtxtemployee = document.getElementById("employeefile-custom-text");
     
      custombtndesign.addEventListener("click",function(){
        realFilebtndesign.click();

      })
      realFilebtndesign.addEventListener("change",function(){
        if(realFilebtndesign.value){
          customtxtdesign.innerHTML = realFilebtndesign.value;
        }
        else{
          customtxtdesign.innerHTML = "No file choosen yet";
        }
      })


      custombtndepart.addEventListener("click",function(){
        realFilebtndepart.click();

      })
      realFilebtndepart.addEventListener("change",function(){
        if(realFilebtndepart.value){
          customtxtdepart.innerHTML = realFilebtndepart.value;
        }
        else{
          customtxtdepart.innerHTML = "No file choosen yet";
        }
      })

      custombtnlocation.addEventListener("click",function(){
        realFilebtnlocation.click();

      })
      realFilebtnlocation.addEventListener("change",function(){
        if(realFilebtnlocation.value){
          customtxtlocation.innerHTML = realFilebtnlocation.value;
        }
        else{
          customtxtlocation.innerHTML = "No file choosen yet";
        }
      })

      custombtnemployee.addEventListener("click",function(){
        realFilebtnemployee.click();

      })
      realFilebtnemployee.addEventListener("change",function(){
        if(realFilebtnemployee.value){
          customtxtemployee.innerHTML = realFilebtnemployee.value;
        }
        else{
          customtxtemployee.innerHTML = "No file choosen yet";
        }
      })

      function skipdesignation(){
        $(".progress").css({"width": "33%"});
        $("#departmentmaster").addClass('progress-step-active');
        $("#form-designation").removeClass('form-step-active');
        $("#form-department").addClass('form-step-active');     
      }

      function skipdepartment(){
        $(".progress").css({"width": "66%"});
        $("#locationmaster").addClass('progress-step-active');
        $("#form-designation").removeClass('form-step-active');
        $("#form-department").removeClass('form-step-active');    
        $("#form-location").addClass('form-step-active');    
      }

      function skiplocation(){
        $(".progress").css({"width": "100%"});
        $("#employeemaster").addClass('progress-step-active');
        $("#form-location").removeClass('form-step-active');
        $("#form-designation").removeClass('form-step-active');
        $("#form-department").removeClass('form-step-active');    
        $("#form-employee").addClass('form-step-active'); 
      }

      function uploaddesignation(){

                  var designationfile = $('#designationfile')[0].files[0];
                  
                  if (designationfile == "" || designationfile == null || designationfile == undefined){
                        console.log("designationfile if",designationfile)
                        bootbox.dialog({
                          message:'Please upload designation file to proceed',
                          closeButton: false,
                          buttons: {
                          ok: {
                          label: 'OK', 
                          className: 'btn-danger'
                      }
                  }
                    }
                      );
                    $('#designationfile').focus();
                    return false;
                  }else{
                    var fd = new FormData();
                    fd.append("file", $('#designationfile')[0].files[0])
                    fd.append("csrfmiddlewaretoken", '{{csrf_token}}')
            
                    $.ajax({
                  type: "POST",
                  url:  frontendURL+"company/designation-master-file",
                  data: fd,
                  processData: false,
                  contentType: false,
                  success: function (response) {
                    console.log("res", response);
                    if (response.response.n == 1){
                      $(".progress").css({"width": "33%"});
                      $("#departmentmaster").addClass('progress-step-active');
                      $("#form-designation").removeClass('form-step-active');
                      $("#form-department").addClass('form-step-active');     
                      swal({
                          icon: "success",
                          title: "",
                          text: "Designation file uploaded Successfully",
                          button: "Close",
                          });
                    }else{
                      swal({
                          icon: "error",
                          title: "",
                          text: response.response.msg + " " +response.data + " Already exist.",
                          button: "Close",
                          });

                    }
                        
                  },
                });
                  }

                
      }


      function uploaddepartment(){

        var departmentfile = $('#departmentfile')[0].files[0];
        console.log("file",departmentfile)

        
        if (departmentfile == "" || departmentfile == null || departmentfile == undefined){
          console.log("departmentfile if",departmentfile)
          bootbox.dialog({
            message:'Please upload department file to proceed',
            closeButton: false,
            buttons: {
            ok: {
            label: 'OK', 
            className: 'btn-danger'
        }
    }
          }
            );
          $('#departmentfile').focus();
          return false;
        }else{
          var fd = new FormData();
          fd.append("file", $('#departmentfile')[0].files[0])
          fd.append("csrfmiddlewaretoken", '{{csrf_token}}')
  
          $.ajax({
              type: "POST",
              url:  frontendURL+"company/departmentfiledata",
              data: fd,
              processData: false,
              contentType: false,
              success: function (response) {

                console.log("res", response);
                if (response.response.n == 1){
                $(".progress").css({"width": "66%"});
                $("#locationmaster").addClass('progress-step-active');
                $("#form-designation").removeClass('form-step-active');
                $("#form-department").removeClass('form-step-active');    
                $("#form-location").addClass('form-step-active');    
                swal({
                icon: "success",
                title: "",
                text: "Department file uploaded Successfully",
                button: "Close",
                });
          }else{
            swal({
                icon: "error",
                title: "",
                text: response.response.msg + " " +response.data + " Already exist.",
                button: "Close",
                });

          }
                
              },
            });
        }

       
        }

      function uploadlocation(){

        var locationfile = $('#locationfile')[0].files[0];
        console.log("file",locationfile)

        if (locationfile == "" || locationfile == null || locationfile == undefined){
          console.log("locationfile if",locationfile)
          bootbox.dialog({
            message:'Please upload location file to proceed',
            closeButton: false,
            buttons: {
            ok: {
            label: 'OK', 
            className: 'btn-danger'
        }
    }
          }
            );
          $('#locationfile').focus();
          return false;
        }else{
          var fd = new FormData();
          fd.append("file", $('#locationfile')[0].files[0])
          fd.append("csrfmiddlewaretoken", '{{csrf_token}}')
  
          $.ajax({
            type: "POST",
            url:  frontendURL+"company/locationfiledata",
            data: fd,
            processData: false,
            contentType: false,
            success: function (response) {
              console.log("res", response);
              if (response.response.n == 1){
              $(".progress").css({"width": "100%"});
              $("#employeemaster").addClass('progress-step-active');
              $("#form-location").removeClass('form-step-active');
              $("#form-designation").removeClass('form-step-active');
              $("#form-department").removeClass('form-step-active');    
              $("#form-employee").addClass('form-step-active'); 
              swal({
                icon: "success",
                title: "",
                text: "Location file uploaded Successfully",
                button: "Close",
                });
          }else{
            swal({
                icon: "error",
                title: "",
                text: response.response.msg + " " +response.data + " Already exist.",
                button: "Close",
                });

          }
            },
          });
        }

       
      }


      function uploademployee(){
      

        var employeefile = $('#employeefile')[0].files[0];
        console.log("file",employeefile)

        if (employeefile == "" || employeefile == null || employeefile == undefined){
          console.log("employeefile if",employeefile)
          bootbox.dialog({
            message:'Please upload employee file to proceed',
            closeButton: false,
            buttons: {
            ok: {
            label: 'OK', 
            className: 'btn-danger'
        }
    }
          }
            );  
          $('#employeefile').focus();
          return false;
        }
          else{

            var fd = new FormData();
            fd.append("employeefile", $('#employeefile')[0].files[0])
            fd.append("csrfmiddlewaretoken", '{{csrf_token}}')
    
          $.ajax({
          type: "POST",
          url: frontendURL+"company/employee-excel",
          data: fd,
          processData: false,
          contentType: false,
          success: function (response) {
            console.log("res", response);
            if (response.response.n == 1){
              swal({
                icon: "success",
                title: "",
                text: "Employees data file uploaded Successfully",
                button: "Close",
                });
            window.location.href = frontendURL+"company/addrules";
            }else if (response.response.n == 2){
              swal({
                icon: "error",
                title: "",
                text: response.response.msg + "   "+ response.data +"Not Found",
                button: "Close",
                });
           
            }
            else{
              swal({
                icon: "error",
                title: "",
                text: response.response.msg + "   "+ response.data +" already exist",
                button: "Close",
                });
            }
          },
          }); 
          }
      }
    </script>

  </body>
</html>
