{% extends "index.html" %}
{% load static %} 
{% block headercontent %}
Upload Masters

{% endblock %}
{% block content %}
    
<style>
     .skipbtn {
    /* width: 20%; */
    /* padding: 0.4rem; */
    display: block;
    text-decoration: none;
    background-color: rgb(197, 192, 192);
    color: #f3f3f3;
    text-align: center;
    cursor: pointer;
    transition: 0.3s;
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    /* font-weight: 500; */
}
.skipbtn:hover{
  background-color: rgb(197, 192, 192);
    color: #f3f3f3;
}
    </style>
 
   <!-- ==================Navbar(Header)======================= -->
 
 
    <!-- Main page -> Manage Task -->
    <main class="add-main-wrapper">
      <!-- ==================Row1======================= -->
      <div class="email-box-section">
         <form action="#" class="form">
          <!-- Progress bar -->
          <div class="progressbar">
            <div class="progress" id="progress"></div>
            <div class="progress-step progress-step-active" data-title="Designation Master">
                <i class=" fa fa-solid fa-person"></i>
            </div>
            <div class="progress-step" data-title="Department Master" id="departmentmaster">
                <i class=" fa fa-solid fa-building"></i>
            </div>
            <div class="progress-step" data-title="Location Master" id="locationmaster">
                <i class=" fa fa-solid fa-location-arrow"></i>
            </div>
            <div class="progress-step" data-title="Employee Master" id="employeemaster">
                <i class=" fa fa-solid fa-person"></i>
              </div>
          </div>

          <!-- Steps -->
          <div class="form-step form-step-active" id="form-designation">
            <div class="row">
              <!-- <div class="mt-3 text-center">
                <button id="button" >Upload Excel Sheet</button>
              </div> -->
         
            <!-- <div class="file-button-wrap">
            
              <label class="filebutton" for="fileupload">  <span class="me-1"><i class="fa fa-download"></i></span>Upload Excel File</label>
              <input id="fileupload" type="file" name="panFile">
              <div class="image-preview1" id="imagePreview1">
            
              </div>
            </div> -->
            <div class="d-flex justify-content-center">
            <div class="file-upload-box">
           <div class="file-upload-btn">
              <input id="designationfile"  type="file" hidden="hidden">
              <button type="button" id="designationfile-custom-button">Upload Excel File</button>
              <p id="designationfile-custom-text">No File chosen,yet.<a class="text-primary cursor-pointer" href="{% static 'Media/SampleExcels/designation.xlsx'%}" download>Download Excel</a>
              </p>
          </div>
          </div>
        </div>
        
            </div>
            <div class="d-flex justify-content-end my-3">
              <a onclick="skipdesignation();"href="javascript:void(0);" class="skipbtn btn-next me-1">Skip and continue</a>
              <a onclick="uploaddesignation();"href="javascript:void(0);" class="wizardbtn btn-next">Save and continue</a>
            </div>
          </div>
          <div class="form-step" id="form-department">
            <div class="row">
              <div class="d-flex justify-content-center">
                <div class="file-upload-box">
               <div class="file-upload-btn">
                  <input id="departmentfile" type="file" hidden="hidden">
                  <button type="button" id="departmentfile-custom-button">Upload Excel File</button>
                  <p id="departmentfile-custom-text">No File chosen,yet.<a class="text-primary cursor-pointer" href="{% static 'Media/SampleExcels/department.xlsx'%}" download>Download Excel</a></p>
              </div>
              </div>
            </div>
            </div>
            <div class="d-flex justify-content-end my-3">
              <a onclick="skipdepartment();" href="javascript:void(0);" class="skipbtn btn-next me-1">Skip and continue</a>
              <a onclick="uploaddepartment();" href="javascript:void(0);" class="wizardbtn btn-next">Save and continue</a>
            </div>
          </div>
          <div class="form-step" id="form-location">
            <div class="row">
              <div class="d-flex justify-content-center">
                <div class="file-upload-box">
               <div class="file-upload-btn">
                  <input id="locationfile" type="file" hidden="hidden">
                  <button type="button" id="locationfile-custom-button">Upload Excel File</button>
                  <p id="locationfile-custom-text">No File chosen,yet. <a class="text-primary cursor-pointer" href="{% static 'Media/SampleExcels/location.xlsx'%}" download>Download Excel</a></p>
              </div>
              </div>
            </div>
            </div>
            <div class="d-flex justify-content-end my-3">
              <a onclick="skiplocation();" href="javascript:void(0);" class="skipbtn btn-next me-1">Skip and continue</a>
                <a onclick="uploadlocation();" href="javascript:viod(0);" class="wizardbtn btn-next">Save and continue</a>
              </div>
          </div>
          <div class="form-step" id="form-employee">
            <div class="row">
              <div class="d-flex justify-content-center">
                <div class="file-upload-box">
               <div class="file-upload-btn">
                  <input id="employeefile" type="file" hidden="hidden">
                  <button type="button" id="employeefile-custom-button">Upload Excel File</button>
                  <p id="employeefile-custom-text">No File chosen,yet.<a class="text-primary cursor-pointer" href="{% static 'Media/SampleExcels/employee.xlsx'%}" download>Download Excel</a></p>
              </div>
              </div>
            </div>
            </div>
            <div class="d-flex justify-content-end mb-3">
                <div class="d-flex justify-content-end mb-3">
                    <span onclick="uploademployee();" class="wizardbtn" >Save</span>
                  </div>
            </div>
          </div>
        </form>
      </div>
    </main>
{% endblock %}
{% block script %}
{{block.super}}
  
    <script>
      var frontendURL = '{{basefrontendUrl}}'

      const realFilebtndesign = document.getElementById("designationfile");
      const realFilebtndepart = document.getElementById("departmentfile");
      const realFilebtnlocation = document.getElementById("locationfile");
      const realFilebtnemployee = document.getElementById("employeefile");
      const custombtndesign = document.getElementById("designationfile-custom-button");
      const custombtndepart = document.getElementById("departmentfile-custom-button");
      const custombtnlocation = document.getElementById("locationfile-custom-button");
      const custombtnemployee = document.getElementById("employeefile-custom-button");
      const customtxtdesign = document.getElementById("designationfile-custom-text");
      const customtxtdepart = document.getElementById("departmentfile-custom-text");
      const customtxtlocation = document.getElementById("locationfile-custom-text");
      const customtxtemployee = document.getElementById("employeefile-custom-text");
     
      custombtndesign.addEventListener("click",function(){
        realFilebtndesign.click();

      })
      realFilebtndesign.addEventListener("change",function(){
        if(realFilebtndesign.value){
          customtxtdesign.innerHTML = realFilebtndesign.value;
        }
        else{
          customtxtdesign.innerHTML = "No file choosen yet";
        }
      })


      custombtndepart.addEventListener("click",function(){
        realFilebtndepart.click();

      })
      realFilebtndepart.addEventListener("change",function(){
        if(realFilebtndepart.value){
          customtxtdepart.innerHTML = realFilebtndepart.value;
        }
        else{
          customtxtdepart.innerHTML = "No file choosen yet";
        }
      })

      custombtnlocation.addEventListener("click",function(){
        realFilebtnlocation.click();

      })
      realFilebtnlocation.addEventListener("change",function(){
        if(realFilebtnlocation.value){
          customtxtlocation.innerHTML = realFilebtnlocation.value;
        }
        else{
          customtxtlocation.innerHTML = "No file choosen yet";
        }
      })

      custombtnemployee.addEventListener("click",function(){
        realFilebtnemployee.click();

      })
      realFilebtnemployee.addEventListener("change",function(){
        if(realFilebtnemployee.value){
          customtxtemployee.innerHTML = realFilebtnemployee.value;
        }
        else{
          customtxtemployee.innerHTML = "No file choosen yet";
        }
      })

      function skipdesignation(){
        $(".progress").css({"width": "33%"});
        $("#departmentmaster").addClass('progress-step-active');
        $("#form-designation").removeClass('form-step-active');
        $("#form-department").addClass('form-step-active');     
      }

      function skipdepartment(){
        $(".progress").css({"width": "66%"});
        $("#locationmaster").addClass('progress-step-active');
        $("#form-designation").removeClass('form-step-active');
        $("#form-department").removeClass('form-step-active');    
        $("#form-location").addClass('form-step-active');    
      }

      function skiplocation(){
        $(".progress").css({"width": "100%"});
        $("#employeemaster").addClass('progress-step-active');
        $("#form-location").removeClass('form-step-active');
        $("#form-designation").removeClass('form-step-active');
        $("#form-department").removeClass('form-step-active');    
        $("#form-employee").addClass('form-step-active'); 
      }

      function uploaddesignation(){

        var designationfile = $('#designationfile')[0].files[0];
        
        if (designationfile == "" || designationfile == null || designationfile == undefined){
          console.log("designationfile if",designationfile)
          bootbox.dialog({
            message:'Please upload designation file to proceed',
            closeButton: false,
            buttons: {
            ok: {
            label: 'OK', 
            className: 'btn-danger'
        }
    }
          }
            );
          $('#designationfile').focus();
          return false;
        }else{
          var fd = new FormData();
          fd.append("file", $('#designationfile')[0].files[0])
          fd.append("csrfmiddlewaretoken", '{{csrf_token}}')
  
          $.ajax({
        type: "POST",
        url:  frontendURL+"company/designation-master-file",
        data: fd,
        processData: false,
        contentType: false,
        success: function (response) {
          console.log("res", response);
          if (response.response.n == 1){
            $(".progress").css({"width": "33%"});
            $("#departmentmaster").addClass('progress-step-active');
            $("#form-designation").removeClass('form-step-active');
            $("#form-department").addClass('form-step-active');     
            swal({
                icon: "success",
                title: "",
                text: "Designation file uploaded Successfully",
                button: "Close",
                });
          }else{
            swal({
                icon: "error",
                title: "",
                text: response.response.msg + " " +response.data + " Already exist.",
                button: "Close",
                });

          }
               
        },
      });
        }

       
      }


      function uploaddepartment(){

        var departmentfile = $('#departmentfile')[0].files[0];
        console.log("file",departmentfile)

        
        if (departmentfile == "" || departmentfile == null || departmentfile == undefined){
          console.log("departmentfile if",departmentfile)
          bootbox.dialog({
            message:'Please upload department file to proceed',
            closeButton: false,
            buttons: {
            ok: {
            label: 'OK', 
            className: 'btn-danger'
        }
    }
          }
            );
          $('#departmentfile').focus();
          return false;
        }else{
          var fd = new FormData();
          fd.append("file", $('#departmentfile')[0].files[0])
          fd.append("csrfmiddlewaretoken", '{{csrf_token}}')
  
          $.ajax({
              type: "POST",
              url:  frontendURL+"company/departmentfiledata",
              data: fd,
              processData: false,
              contentType: false,
              success: function (response) {

                console.log("res", response);
                if (response.response.n == 1){
                $(".progress").css({"width": "66%"});
                $("#locationmaster").addClass('progress-step-active');
                $("#form-designation").removeClass('form-step-active');
                $("#form-department").removeClass('form-step-active');    
                $("#form-location").addClass('form-step-active');    
                swal({
                icon: "success",
                title: "",
                text: "Department file uploaded Successfully",
                button: "Close",
                });
          }else{
            swal({
                icon: "error",
                title: "",
                text: response.response.msg + " " +response.data + " Already exist.",
                button: "Close",
                });

          }
                
              },
            });
        }

       
        }

      function uploadlocation(){

        var locationfile = $('#locationfile')[0].files[0];
        console.log("file",locationfile)

        if (locationfile == "" || locationfile == null || locationfile == undefined){
          console.log("locationfile if",locationfile)
          bootbox.dialog({
            message:'Please upload location file to proceed',
            closeButton: false,
            buttons: {
            ok: {
            label: 'OK', 
            className: 'btn-danger'
        }
    }
          }
            );
          $('#locationfile').focus();
          return false;
        }else{
          var fd = new FormData();
          fd.append("file", $('#locationfile')[0].files[0])
          fd.append("csrfmiddlewaretoken", '{{csrf_token}}')
  
          $.ajax({
            type: "POST",
            url:  frontendURL+"company/locationfiledata",
            data: fd,
            processData: false,
            contentType: false,
            success: function (response) {
              console.log("res", response);
              if (response.response.n == 1){
              $(".progress").css({"width": "100%"});
              $("#employeemaster").addClass('progress-step-active');
              $("#form-location").removeClass('form-step-active');
              $("#form-designation").removeClass('form-step-active');
              $("#form-department").removeClass('form-step-active');    
              $("#form-employee").addClass('form-step-active'); 
              swal({
                icon: "success",
                title: "",
                text: "Location file uploaded Successfully",
                button: "Close",
                });
          }else{
            swal({
                icon: "error",
                title: "",
                text: response.response.msg + " " +response.data + " Already exist.",
                button: "Close",
                });

          }
            },
          });
        }

       
      }


      function uploademployee(){
      

        var employeefile = $('#employeefile')[0].files[0];
        console.log("file",employeefile)

        if (employeefile == "" || employeefile == null || employeefile == undefined){
          console.log("employeefile if",employeefile)
          bootbox.dialog({
            message:'Please upload employee file to proceed',
            closeButton: false,
            buttons: {
            ok: {
            label: 'OK', 
            className: 'btn-danger'
        }
    }
          }
            );  
          $('#employeefile').focus();
          return false;
        }
          else{

            var fd = new FormData();
            fd.append("employeefile", $('#employeefile')[0].files[0])
            fd.append("csrfmiddlewaretoken", '{{csrf_token}}')
    
          $.ajax({
          type: "POST",
          url: frontendURL+"company/employee-excel",
          data: fd,
          processData: false,
          contentType: false,
          success: function (response) {
            console.log("res", response);
            if (response.response.n == 1){
              swal({
                icon: "success",
                title: "",
                text: "Employees data file uploaded Successfully",
                button: "Close",
                });
            window.location.href = frontendURL+"company/addrules";
            }else if (response.response.n == 2){
              swal({
                icon: "error",
                title: "",
                text: response.response.msg + "   "+ response.data +"Not Found",
                button: "Close",
                });
           
            }
            else{
              swal({
                icon: "error",
                title: "",
                text: response.response.msg + "   "+ response.data +" already exist",
                button: "Close",
                });
            }
          },
          }); 
          }
      }
    </script>

{% endblock %}
