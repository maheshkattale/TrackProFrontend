{% extends "index.html" %}
{% load static %} 
{% block headercontent %}
<div class="nav-item newheading">
Designation Master
</div>

{% endblock %}
{% block content %}
<link rel="stylesheet" href="{% static 'assets/css/companylist.css' %}">
<style>
  .fa-minus-circle{
    font-size:22px
  }
  .form-floating .form-control {
    border: none;
    border-bottom: 1px solid #c2c2c2;
    box-shadow:None;
    border-radius: 0px;
    outline:none;
}
.form-floating>label {
    padding: 10px 0;
}

#addEmployeeForm input {
    width: 100%;
    font-size: 14px;
    color: black; 

}
.modal-body input {
  font-size: 14px;
  margin-bottom: 10px;
}
</style>
<main class="main-wrapper">
    {% if messages %}
      <div class="row" style="justify-content: center;">
        <div class="col-sm-6 col-sm-offset-3">
          {% for message in messages %}
          <div style="display: flex; margin: 15px 0px;flex-direction: row-reverse;justify-content: center;align-items: center;" class="alert-meaasge alert alert-{{ message.tags }} alert-dismissible text-center" role="alert">
            <button type="button" class="close" data-dismiss="alert" aria-label="Close" style="background: transparent; border: none; font-size: 25px; color: #ff0000;">
              <span aria-hidden="true">&times;</span>
            </button>
            <p style="margin-bottom: 0px;">{{ message }}</p>
          </div>
          {% endfor %}
        </div>
      </div>
    {% endif %}
    <div id="snackbar"></div>


    <form  method="POST" id="" enctype="multipart/form-data">
      {% csrf_token %}
      
        <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered w-25">
            <div class="modal-content">
              <div class="modal-header ps-4">
                <h5 class="modal-title my-3" id="exampleModalLabel">Add Designation</h5>
              </div>
              <div class="modal-body">
                <div class="row">
                  <div class="col-12 px-4">
                    <div class="form-floating">
                      <input type="text"  class="form-control"  id="DesignationName" placeholder="Enter designation" name="DesignationName" oninput="this.value = this.value.replace(/[^a-zA-Z ]+/g,'').replace(/(\..*)\./g, '$1');">
                      <label for="DesignationName">Designation Name<span style="color:red">*</span></label>
                      <span id="DesignationNameerror" class="error"></span>
                    </div>




                  </div>
                </div>
              </div>
              <div class="modal-footer">
                <button type="button" class="Role-btn modalClose" data-bs-dismiss="modal">Close</button>
                <button type="submit" class="trackproBtn Role-btn" id="editEmployeeDetails"  onclick="return formValidation();">Submit</button>
              </div>
            </div>
          </div>
        </div>        






    

    </form>

    <div class="table-div">
      <table id="myTable" class="row-border" style="width:100%">
        <thead>
          <tr class="tableHeadings roleTableheadings">
            <th style="width:20%;text-align: center;">Sr. No</th>
            <th style="width:60%;text-align: center;">Designation Name</th>
            <th style="width:20%;text-align: center;">Action</th>
          </tr>
        </thead>
        <tbody>
          {%for i in designationlist %}
          <tr>
              <td style="text-align: center;">{{forloop.counter}}</td>
              <td style="text-align: center;"> {{i.DesignationName}}</td>
              <td class="actionflex">
                  <a class="viewEmpDeetsBtn me-2" data-bs-toggle="modal" data-bs-target="#modal{{i.id}}"><img class="edit-icon" src="{% static 'assets/images/Group 16728.svg' %}" height="20px" alt="edit icon">
                  </a>   

                  {%if i.Used == True %}
                  <a class="px-1" onclick="return false;"><i class="fa text-danger fa-minus-circle" aria-hidden="true" data-bs-toggle="tooltip" title="used"></i>
                  {%else%}
                  
                  <a class="px-1" data-bs-toggle="modal"  data-bs-target="#deletedesignation{{i.id}}" ><img src="{% static 'assets/images/Group 16729.svg' %}" height="20px" alt="delete icon" data-bs-toggle="tooltip" title="unused"></a>
                  <div class="modal fade" id="deletedesignation{{i.id}}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered w-25">
                    
                      <div class="modal-content">           
                        <div class="modal-header ps-3 text-center">
                          <h5 class="modal-title py-2" id="exampleModalLabel">Delete Designation</h5>
                        </div>
                        <div class="modal-body">
                          
                          <div class="row">
                            <div> Are you sure you want to delete this?
            
                            </div>
                         
                        
                       
                       
                          </div>
                        
                        </div>
                        <div class="modal-footer ">
                            <button type="button" class="Role-btn modalClose" data-bs-dismiss="modal">Close</button>
                
                            <a href="{% url 'users:delete_designation' i.id %}"  class="Role-btn text-center" id="addEmployeeBtn">Delete</a>
            
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  
                  {%endif%}
              </td>
          </tr>
          {%endfor%}



        </tbody>                 
      </table>
    </div>

    {% for i in designationlist %}

    
      <div class="modal fade" id="modal{{i.id}}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered w-25">
          <div class="modal-content">
            <div class="modal-header ps-4 ">
              <h5 class="modal-title my-3" id="exampleModalLabel">Designation Details</h5>
            </div>
            <div class="modal-body">
              <div class="row">
                <div class="col-12 px-4">
                  <div class="form-floating">
                    <input type="text" id="updatedesignation{{i.id}}" value="{{i.DesignationName}}" class="form-control" oninput="this.value = this.value.replace(/[^a-zA-Z ]+/g,'').replace(/(\..*)\./g, '$1');">
                    <label for="updatedesignation{{i.id}}">Designation Name</label>
                    <span id="designationnameerror{{i.id}}" class="error-message"></span>
                  </div>
                </div>
              </div>
            </div>

            <div class="modal-footer">
              <button type="button" class="Role-btn modalClose" data-bs-dismiss="modal">Close</button>
              <button type="submit" class="trackproBtn Role-btn" id="editEmployeeDetails" onclick="updateDesignation({{i.id}})">Update</button>
            </div>


          </div>
        </div>
      </div>
    {% endfor %}
</main>

{% endblock %}
{% block indexaddbuttons %}

<li><a data-bs-toggle="modal" data-bs-target="#exampleModal" onclick="clearinput()">
  <img id="icon" class="floatingimg" data-bs-toggle="tooltip" data-bs-placement="left" title="Add Designation"
  src="{% static 'assets/svg/designation.svg' %}">
</a></li>
 {% endblock %}
{% block script %}
{{block.super}}
<script>
  function clearinput(){
    $('#DesignationName').val('');
  }
    $(document).ready(function () {
        $('#myTable').DataTable();
        $('.input-feild').on("focus", function () {
          var label = $('label[for=' + this.id + ']');
          label.delay("slow").animate({ 'font-size': '14px', 'font-weight': '400', 'padding': '1px', }, 'slow');
        });
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
          return new bootstrap.Tooltip(tooltipTriggerEl)
        })
    });



    function formValidation(){

        var DesignationName = $('#DesignationName').val().trim();   
      
        if (IsValid(DesignationName)) {
          $('#DesignationNameerror').show().delay(3000).slideUp();
          $('#DesignationNameerror').html('Designation Name  is required');
          $('#DesignationName').focus();
          return false;
      }
      }

      function updateDesignation(id) {
        var updatedesignation = $('#updatedesignation'+id).val().trim();

        if (IsValid(updatedesignation)) {
          $('#designationnameerror'+id).html('');
          $('#designationnameerror'+id).show().delay(3000).slideUp();
          $('#designationnameerror'+id).html('Designation Name is required');
          $('#updatedesignation'+id).focus();
            return false;
        }else{

        $.ajax({
            type: "POST",
            url: frontendURL + "updatedesignation",
            data: {
                'DesignationName': updatedesignation,
                'designationId':id,
                csrfmiddlewaretoken: '{{ csrf_token }}',
            },
            success: function (response) {         
                console.log("reps",response.data.n)
                if(response.data.n == 1){
                    window.location = frontendURL + "designation";
                }else{
                    window.location = frontendURL + "designation";
                }
                
            }
        });
        }
    }
</script>
{% endblock %}