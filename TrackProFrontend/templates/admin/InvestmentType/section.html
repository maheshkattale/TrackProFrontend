{% extends "index.html" %}
{% load static %} 
{% block headercontent %}
<div class="nav-item newheading">
 Section Master
</div>
{% endblock %}
{% block content %}
<link rel="stylesheet" href="{% static "assets/css/companylist.css" %}">
<style>
  .fa-minus-circle{
    font-size:22px
  }
  .form-floating .form-control {
    border: none;
    border-bottom: 1px solid #c2c2c2;
    box-shadow:None;
    border-radius: 0px;
    outline:none;
}
.form-floating>label {
    padding: 10px 0;
}

#addEmployeeForm input {
    width: 100%;
    font-size: 14px;
    color: black; 

}
.modal-body input {
  font-size: 14px;
  margin-bottom: 10px;
}

.modal-body select{
  font-size: var(--f-lg);
  color: var(--fc-md-dark);
  width: 100%;
  border: none;
  border-bottom: 1px solid rgb(214, 214, 214);
  background: transparent;
  padding-bottom: 8px;
  margin-top: 6px;
  margin-bottom: 28px;
}
.modal-body select:focus{
  outline:none;
  box-shadow:none;
}
textarea{
  resize: none;
}
.form-control{
  background: none !important;
}
.secstyle{
  color:#b1b1b1;
}
.select2-container--default.select2-container--disabled .select2-selection--single{
  background:none !important;
}
</style>
<main class="main-wrapper">
    {% if messages %}
      <div class="row" style="justify-content: center;">
        <div class="col-sm-6 col-sm-offset-3">
          {% for message in messages %}
          <div style="display: flex; margin: 15px 0px;flex-direction: row-reverse;justify-content: center;align-items: center;" class="alert-meaasge alert alert-{{ message.tags }} alert-dismissible text-center" role="alert">
            <button type="button" class="close" data-dismiss="alert" aria-label="Close" style="background: transparent; border: none; font-size: 25px; color: #ff0000;">
              <span aria-hidden="true">&times;</span>
            </button>
            <p style="margin-bottom: 0px;">{{ message }}</p>
          </div>
          {% endfor %}
        </div>
      </div>
    {% endif %}
    <div id="snackbar"></div>


    <form  method="POST" id="" enctype="multipart/form-data">
      {% csrf_token %}
        <div class="title-div">
          <span class="company-title d-none">Section Master</span>
          <span class="add-btn" type="button" data-bs-toggle="modal" data-bs-target="#exampleModal">+ Add Section</span>
        </div>
        <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered w-25">
            <div class="modal-content">
              <div class="modal-header ps-4">
                <h5 class="modal-title my-3" id="exampleModalLabel">Add Section</h5>
              </div>
              <div class="modal-body">
                <div class="row">
                  <div class="col-12 px-4">
                    <div class="form-floating">
                      <input type="text"  class="form-control"  id="Name" placeholder="Enter Name" name="Name" oninput="this.value = this.value.replace(/[^ A-Za-z0-9_@./#&+-]/g, '');">
                      <label for="Name">Section Name:<span style="color:red">*</span></label>
                      <span id="Nameerror" class="error"></span>
                    </div>
                    
                    <div class="form-floating">
                        <input type="text"  class="form-control"  id="Tentativelimit" placeholder="Enter Tentativelimit" name="Tentativelimit" oninput="this.value = this.value.replace(/[^0-9]/g, '').replace(/(\..*)\./g, '$1');">
                        <label for="Tentativelimit">Tentative Limit:<span style="color:red">*</span></label>
                        <span id="Tentativelimiterror" class="error"></span>
                    </div>
                    <div class="form-floating mb-3">
                      <textarea type="text" class="form-control" style="height: 100px;" id="Description" placeholder="Enter Description" name="Description" oninput="this.value = this.value.replace(/[^ A-Za-z0-9_@./#&+-]/g, '');"></textarea>
                      <label for="Designation">Description:<span style="color:red">*</span></label>
                      <span id="Descriptionerror" class="error"></span>
                  </div>
                  <div>
                    <label for="status">Status<span style="color:red">*</span></label>
                    <select id='status' class="select2dropdown" name="status">
                      
                      <option value="1">Active</option>
                      <option value="0">InActive</option>
                     
                    </select>
                    <span id="Name_err" class="error"></span>
                  </div>
                </div>
                  
                </div>
                {% comment %} <div class="col-12">
                  <label for="sectionId">Status<span style="color:red">*</span></label>
                  <select id='status' name="status">
                    <option value="1" >Active</option>
                    <option value="0" >InActive</option>
                  </select>
                  <span id="status_err" class="error"></span>
                </div> {% endcomment %}
              </div>
              <div class="modal-footer">
                <button type="button" class="Role-btn modalClose" data-bs-dismiss="modal">Close</button>
                <button class="trackproBtn Role-btn" id="editEmployeeDetails" onclick="return formValidation();">Submit</button>
              </div>
            </div>
          </div>
        </div>        

    </form>

    <div class="table-div">
      <table id="myTable" class="row-border" style="width:100%">
        <thead>
          <tr class="tableHeadings roleTableheadings">
            <th>Sr. No</th>
            <th>Section Name</th>
            <th>Tentative Limit</th>
            <th>Description</th>
            <th>Active Status</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          {% for i in section_list%}
          <tr>
            <td>{{forloop.counter}}</td>
            <td>{{i.Name}}</td>
            <td>{{i.Tentative_limit}}</td>
            <td>{{i.Description}}</td>
            {% if i.Is_Active == 1 %}
            <td>Active</td>
            {%else%}
            <td>In Active</td>
            {%endif%}
            <td>
                <a class="edit-center" data-bs-toggle="modal" data-bs-target="#updateexampleModal{{i.id}}"><img class="edit-icon" src="{% static 'assets/images/Group 16728.svg' %}" height="20px" alt="edit icon" title="Edit"></a>
                <a class="edit-center" data-bs-toggle="modal" data-bs-target="#viewexampleModal{{i.id}}"><i class="fa fa-regular fa-eye" title="View"></i></a>
              </td>
          </tr>
          <div class="modal fade" id="updateexampleModal{{i.id}}" tabindex="-1" aria-labelledby="updateexampleModal" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered w-25">
              <div class="modal-content">
                <div class="modal-header ps-4">
                  <h5 class="modal-title my-3" id="updateexampleModal">Update Section</h5>
                </div>
                <div class="modal-body">
                  <div class="row">
                    <div class="col-12 px-4">
                      <div class="form-floating">
                        <input type="text"  class="form-control"  id="Name{{i.id}}" placeholder="Enter Name" name="Name" value="{{i.Name}}" oninput="this.value = this.value.replace(/[^ A-Za-z0-9_@./#&+-]/g, '');">
                        <label for="Name">Section Name:<span style="color:red">*</span></label>
                        <span id="Nameerror{{i.id}}" class="error"></span>
                      </div>
                      
                      <div class="form-floating">
                          <input type="text"  class="form-control"  id="Tentativelimit{{i.id}}" placeholder="Enter Tentativelimit" value="{{i.Tentative_limit}}" name="Tentativelimit" oninput="this.value = this.value.replace(/[^0-9]/g, '').replace(/(\..*)\./g, '$1');">
                          <label for="Tentativelimit">Tentative Limit:<span style="color:red">*</span></label>
                          <span id="Tentativelimiterror{{i.id}}" class="error"></span>
                      </div>
                      <div class="form-floating mb-2">
                        <textarea type="text"  class="form-control" style="height: 100px;" id="Description{{i.id}}" placeholder="Enter Description"  name="Description" oninput="this.value = this.value.replace(/[^ A-Za-z0-9_@./#&+-]/g, '');">{{i.Description}}</textarea>
                        <label for="Description">Description:<span style="color:red">*</span></label>
                        <span id="Descriptionerror{{i.id}}" class="error"></span>
                    </div>
                    <div>
                      <label for="status{{i.id}}" style="color:#b1b1b1">Status<span style="color:red">*</span></label>
                      <select id="status{{i.id}}" class="select2dropdown" name="status{{i.id}}">
                   
                      {% if i.Is_Active == 1%}
                      <option value="1" selected>Active</option>
                      <option value="0">InActive</option>
                      {%else%}
                      <option value="1">Active</option>
                      <option value="0" selected>InActive</option>
                      {%endif%}
                      </select>
                      <span id="status_err{{i.id}}" class="error"></span>
                    </div>
                    </div>
                  </div>
                  
                </div>
                <div class="modal-footer">
                  <button type="button" class="Role-btn modalClose" data-bs-dismiss="modal">Close</button>
                  <button class="trackproBtn Role-btn" id="editEmployeeDetails"  onclick="updatesection({{i.id}});">Submit</button>
                </div>
              </div>
            </div>
          </div>
          <div class="modal fade" id="viewexampleModal{{i.id}}" tabindex="-1" aria-labelledby="viewexampleModal" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered w-25">
              <div class="modal-content">
                <div class="modal-header ps-4">
                  <h5 class="modal-title my-3" id="viewexampleModal{{i.id}}">View Section</h5>
                </div>
                <div class="modal-body">
                  <div class="row">
                    <div class="col-12 px-4">
                      <div class="form-floating">
                        <input type="text"  class="form-control"  id="Name{{i.id}}"disabled placeholder="Enter Name" name="Name" value="{{i.Name}}" oninput="this.value = this.value.replace(/[^ A-Za-z0-9_@./#&+-]/g, '');">
                        <label for="Name">Section Name:<span style="color:red">*</span></label>
                        <span id="Nameerror{{i.id}}" class="error"></span>
                      </div>
                      
                      <div class="form-floating">
                          <input type="text"  class="form-control"  id="Tentativelimit{{i.id}}" disabled placeholder="Enter Tentativelimit" value="{{i.Tentative_limit}}" name="Tentativelimit" oninput="this.value = this.value.replace(/[^0-9]/g, '').replace(/(\..*)\./g, '$1');">
                          <label for="Tentativelimit">Tentative Limit:<span style="color:red">*</span></label>
                          <span id="Tentativelimiterror{{i.id}}" class="error"></span>
                      </div>
                      <div class="form-floating mb-2">
                        <textarea type="text"  class="form-control"  id="Description{{i.id}}" disabled placeholder="Enter Description"  name="Description" oninput="this.value = this.value.replace(/[^ A-Za-z0-9_@./#&+-]/g, '');">{{i.Description}}</textarea>
                        <label for="Description">Description:<span style="color:red">*</span></label>
                        <span id="Descriptionerror{{i.id}}" class="error"></span>
                    </div>
                    <div>
                      <label for="status{{i.id}}" class="secstyle">Status<span style="color:red">*</span></label>
                      <select id="status{{i.id}}" class="select2dropdown" name="status{{i.id}}" disabled>
                   
                      {% if i.Is_Active == 1%}
                      <option value="1" selected>Active</option>
                      <option value="0">InActive</option>
                      {%else%}
                      <option value="1">Active</option>
                      <option value="0" selected>InActive</option>
                      {%endif%}
                      </select>
                      <span id="status_err{{i.id}}" class="error"></span>
                    </div>
                    </div>
                  </div>
                  
                </div>
                <div class="modal-footer">
                  <button type="button" class="Role-btn modalClose" data-bs-dismiss="modal">Close</button>
                  
                </div>
              </div>
            </div>
          </div>
          {%endfor%}
          
        </tbody>                 
      </table>
    </div>

    

    
 
</main>
{% endblock %}
{% block script %}
{{block.super}}
<script>
    $(document).ready(function () {
        $('#myTable').DataTable();
        $('.input-feild').on("focus", function () {
          var label = $('label[for=' + this.id + ']');
          label.delay("slow").animate({ 'font-size': '14px', 'font-weight': '400', 'padding': '1px', }, 'slow');
        });
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
          return new bootstrap.Tooltip(tooltipTriggerEl)
        })
    });

    function IsValid(value){
      if (value == ""||value==null||value==undefined){
        return true;
      }else{
        return false;
      }
    }
    function formValidation(){
       
        var Name = $('#Name').val().trim();   
        var Tentativelimit = $('#Tentativelimit').val().trim();   
        var Description = $('#Description').val().trim();   
        
      
        if (IsValid(Name)) {
          $('#Name').html();
          $('#Nameerror').show().delay(3000).slideUp();
          $('#Nameerror').html('Section Name is required');
          $('#Name').focus();
          return false;
        } 
        if (IsValid(Tentativelimit)) {
            $('#Tentativelimit').html();
            $('#Tentativelimiterror').show().delay(3000).slideUp();
            $('#Tentativelimiterror').html('Tentative limit is required');
            $('#Tentativelimit').focus();
            return false;
        }
        if (IsValid(Description)) {
          $('#Description').html();
          $('#Descriptionerror').show().delay(3000).slideUp();
          $('#Descriptionerror').html('Description is required');
          $('#Description').focus();
          return false;
      } 
    }

      function updatesection(id) {
         
        var Name = $('#Name'+id).val().trim();
        var Tentativelimit = $('#Tentativelimit'+id).val().trim();
        var Description = $('#Description'+id).val().trim();
        var status =$('#status'+id).val()
        if (IsValid(Name)) {
          $('#Name'+id).html();
          $('#Nameerror'+id).show().delay(3000).slideUp();
          $('#Nameerror'+id).html('Section Name is required');
          $('#Name'+id).focus();
          return false;
        } 
        if (IsValid(Tentativelimit)) {
            $('#Tentativelimit'+id).html();
            $('#Tentativelimiterror'+id).show().delay(3000).slideUp();
            $('#Tentativelimiterror'+id).html('Tentative limit is required');
            $('#Tentativelimit'+id).focus();
            return false;
        }
        if (IsValid(Description)) {
          $('#Description'+id).html();
          $('#Descriptionerror'+id).show().delay(3000).slideUp();
          $('#Descriptionerror'+id).html('Description is required');
          $('#Description'+id).focus();
          return false;
      }else{
        
      

        $.ajax({
            type: "POST",
            url: frontendURL + "/investment-type/update-section",
            data: {
                'Name': Name,
                'Description':Description,
                'Tentativelimit':Tentativelimit,
                'sectionId':id,
                'status':status,
                csrfmiddlewaretoken: '{{ csrf_token }}',
            },
            success: function (response) {         
                console.log("reps",response.data.n)
                if(response.data.n == 1){
                    window.location = frontendURL + "/investment-type/section";
                }else{
                    window.location = frontendURL + "/investment-type/section";
                }
                
            }
        });
      }
        }
    
</script>
{% endblock %}