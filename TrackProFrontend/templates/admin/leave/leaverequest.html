{% extends "index.html" %}
{% load static %}
{% load encryption_filters %}

{% block headercontent %}
<div class="nav-item newheading">
  Leave Requests
</div>
{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'assets/css/companylist.css' %}">
<link rel="stylesheet" href="{% static 'assets/css/leave_request.css' %}">

<main class="main-wrapper">


  <div class="title-div">

    <span class="company-title"></span>
    <button class="fiterBtn" id="filterBtn" type="button" data-bs-toggle="collapse" data-bs-target="#filtersRow"
      aria-expanded="false" aria-controls="filtersRow"></button>

  </div>
  <div class="row my-2 mb-5 collapse" id="filtersRow">

    <span class="d-flex justify-content-between align-items-center pe-4">

      <span class="application-filter-box px-2">
        <input class="searchbar-input-feild" type="text" id="searchbar" onkeyup="search_by_name();"
          placeholder="Search by Employee Name" />
      </span>


      <span class="application-filter-box px-2">

        <select class="input-feild select2dropdown" id="ApplicationType" onchange="search_by_name();">
          <option value="" selected>All</option>
          <option value="Leave"> Leave</option>
          <option value="Work From Home">Work from home</option>
        </select>
      </span>

      <div class="application-filter-box px-2">
        <select class="input-feild select2dropdown" id="searchdept" onchange="search_by_name();">
          <option selected value="">Search by Department</option>

        </select>
      </div>

      <span class="application-filter-box px-2">

        <select class="input-feild select2dropdown" id="search_month" onchange="search_by_name();">
          <option value="" selected>Select Month</option>
          <option value="1">January</option>
          <option value="2">February</option>
          <option value="3">March</option>
          <option value="4">April</option>
          <option value="5">May</option>
          <option value="6">June</option>
          <option value="7">July</option>
          <option value="8">August</option>
          <option value="9">September</option>
          <option value="10">October</option>
          <option value="11">November</option>
          <option value="12">December</option>
        </select>

      </span>


      <span class="application-filter-box px-2">

        <select class="input-feild select2dropdown" id="search_year" onchange="search_by_name();">

        </select>

      </span>



    </span>
  </div>


  <div class="leads-div">

    <!-- Card-Box_Nav-Bar_Nav-Pills -->
    <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
      <li class="nav-item p-0 m-0" role="presentation">
        <button class="nav-link active" id="pills-all-tab" onclick="get_applications('all');" data-bs-toggle="pill"
          data-bs-target="#pills-all" type="button" role="tab" aria-controls="pills-all" aria-selected="true">All
          Application</button>
      </li>
      <li class="nav-item p-0 m-0" role="presentation">
        <button class="nav-link" id="pills-pending-tab" onclick="get_applications('pending');" data-bs-toggle="pill"
          data-bs-target="#pills-pending" type="button" role="tab" aria-controls="pills-pending"
          aria-selected="true">Pending Application</button>
      </li>

      <li class="nav-item p-0 m-0" role="presentation">
        <button class="nav-link" id="pills-approved-tab" onclick="get_applications('approved');" data-bs-toggle="pill"
          data-bs-target="#pills-approved" type="button" role="tab" aria-controls="pills-approved"
          aria-selected="false">Approved Application</button>
      </li>
      <li class="nav-item p-0 m-0" role="presentation">
        <button class="nav-link" id="pills-rejected-tab" onclick="get_applications('rejected');" data-bs-toggle="pill"
          data-bs-target="#pills-rejected" type="button" role="tab" aria-controls="pills-rejected"
          aria-selected="false">Rejected Application</button>
      </li>
      <li class="nav-item p-0 m-0" role="presentation">
        <button class="nav-link" id="pills-withdraw-tab" onclick="get_applications('withdraw');" data-bs-toggle="pill"
          data-bs-target="#pills-withdraw" type="button" role="tab" aria-controls="pills-withdraw"
          aria-selected="false">Withdrawn Application</button>
      </li>
      <li class="nav-item p-0 m-0" role="presentation">
        <button class="nav-link" id="pills-expired-tab" onclick="get_applications('expired');" data-bs-toggle="pill"
          data-bs-target="#pills-expired" type="button" role="tab" aria-controls="pills-expired"
          aria-selected="false">Expired Application</button>
      </li>
    </ul>

    <div class="tab-content" id="pills-tabContent">


      <!-- 1st-Pane -->
      <div class="tab-pane fade show active" id="pills-all" role="tabpanel" aria-labelledby="pills-all-tab"
        tabindex="0">
        <div class="row" id="all-applications">


        </div>
      </div>
      <!-- 2nd Pane -->

      <div class="tab-pane fade show " id="pills-pending" role="tabpanel" aria-labelledby="pills-pending-tab"
        tabindex="0">

        <div class="row" id="pending-applications">


        </div>

      </div>
      <!-- 3rd Pane -->

      <div class="tab-pane fade" id="pills-approved" role="tabpanel" aria-labelledby="pills-approved-tab" tabindex="0">

        <div class="row" id="approved-applications">


        </div>

      </div>
      <!-- 4th Pane-->

      <div class="tab-pane fade" id="pills-rejected" role="tabpanel" aria-labelledby="pills-rejected-tab" tabindex="0">

        <div class="row" id="rejected-applications">


        </div>


      </div>
      <!-- 5th Pane -->

      <div class="tab-pane fade" id="pills-withdraw" role="tabpanel" aria-labelledby="pills-withdraw-tab" tabindex="0">

        <div class="row" id="withdraw-applications">


        </div>

      </div>

      <!-- 6th Pane -->
      <div class="tab-pane fade" id="pills-expired" role="tabpanel" aria-labelledby="pills-expired-tab" tabindex="0">
        <div class="row" id="expired-applications">


        </div>
      </div>
    </div>

  </div>



</main>


{% endblock %}
{% block script %}
{{block.super}}


<script>
  var tab_status = 'all'
  $(document).ready(function () {
    var currentYear = new Date().getFullYear();
    getdepartmentlist()

    // Populate the select tag with options for the past 50 years
    for (var year = currentYear + 1; year >= currentYear - 49; year--) {
      $('#search_year').append($('<option>', {
        value: year,
        text: year
      }));
    }

    $('#search_year').val(currentYear)

    get_applications('all');

  });
  function search_by_name() {
    get_applications(tab_status)
  }

  function get_applications(status) {
    tab_status = status
    var formData = new FormData();

    var name = $("#searchbar").val()
    var ApplicationType = $("#ApplicationType").val()
    var department_value = $("#searchdept").val()
    var year = $("#search_year").val()
    var month = $("#search_month").val()

    formData.append('csrfmiddlewaretoken', '{{ csrf_token }}');
    formData.append('name', name);
    formData.append('ApplicationType', ApplicationType);
    formData.append('department_value', department_value);
    formData.append('year', year);
    formData.append('month', month);
    formData.append('status', status);

    $.ajax({
      url: frontendURL + "get_applications_requests",
      type: 'POST',
      data: formData,
      processData: false,
      contentType: false,
      dataType: 'json',
      beforeSend: function () {
        swal({
          icon: "info",
          title: "",
          text: "Loading...",
          buttons: false,
        });
      },
      success: function (response) {
        swal.close();
        console.log("response", response)
        var col_div = ''

        if (response.response.n == 1) {

          $(response.data).each(function (a, b) {

            var encrypted_leave_id = btoa(b.id.toString());
            var encrypted_id = btoa(b.approval_id.toString());
            var url = "/leave/leavedetails/" + encrypted_leave_id + "/" + encrypted_id;
            col_div += ` 
                    

                        <div class="col-lg-4 col-md-6 col-sm-12 mt-4">
                            <div id="card" class="card text-start h-100">


                                <div class="card-header d-flex justify-content-between pb-0 col-lg-12 card-header-name-txt">
                                <span class="card-header-blue-txt text-black">`+ b.applicant_name + `</span>
                                <span class="d-flex">  
                                    
                                   ${b.reverse_action != null ? `
                                     ${b.reverse_action === true ? `
                                        <span class="cursor-pointer px-1"  onclick="re_reject_application(`+b.approval_id+`)"   title="Reject this Application"><i class="fa fa-solid fa-rotate-left text-danger" aria-hidden="true"></i></span>
                                    ` : `
                                        <span class="cursor-pointer px-1"  onclick="re_approve_application(`+b.approval_id+`)"  title="Approve this Application"><i class="fa fa-solid fa-rotate-left text-success" aria-hidden="true"></i></span>

                                    `}
                                   
                                   ` : ``}


                                   ${b.attachment === '' ? `` : `
                                   
                                      <span class="px-2"   title="attachment" data-bs-toggle="modal" data-bs-target="#jsattachmentmodel`+b.approval_id+`"><i class="fa fa-solid fa-folder-open text-primary" aria-hidden="true"></i></span>


                                      <div class="modal fade" id="jsattachmentmodel`+b.approval_id+`" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                        <div class="modal-dialog modal-dialog-centered modal-lg">
                                        
                                          <div class="modal-content">           
                                            <div class="modal-header ps-4">
                                              <h5 class="modal-title py-2" id="exampleModalLabel">Attachment</h5>
                                            </div>

                                            <div class="modal-body">
                                              <img class="w-100" src="`+b.attachment+`" alt="">
                                            </div>
                              

                                            <div class="modal-footer">
                                
                                              <div class="w-50 text-center">
                                                <button type="button"class="Role-btn modalClose" data-bs-dismiss="modal">Close</button>
                                              </div>
                              
                                            </div>
                                          </div>

                                        </div>

                                      </div>
                                   

                                   
                                   
                                   `}


                                <a href="`+url+`" >
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 36 36" fill="none">
                                  <path d="M27.8438 2.25H8.15625C4.89994 2.25 2.25 5.14084 2.25 8.69318V27.3068C2.25 30.8592 4.89994 33.75 8.15625 33.75H27.8438C31.1001 33.75 33.75 30.8592 33.75 27.3068V8.69318C33.75 5.14084 31.1001 2.25 27.8438 2.25ZM32.4375 27.3068C32.4375 30.0702 30.3769 32.3182 27.8438 32.3182H8.15625C5.62313 32.3182 3.5625 30.0702 3.5625 27.3068V8.69318C3.5625 5.92977 5.62313 3.68182 8.15625 3.68182H27.8438C30.3769 3.68182 32.4375 5.92977 32.4375 8.69318V27.3068ZM28.5 10.125C28.5 10.5202 28.206 10.8409 27.8438 10.8409H14.7188C14.3565 10.8409 14.0625 10.5202 14.0625 10.125C14.0625 9.72982 14.3565 9.40909 14.7188 9.40909H27.8438C28.206 9.40909 28.5 9.72982 28.5 10.125ZM10.125 10.125C10.125 10.9154 9.537 11.5568 8.8125 11.5568C8.088 11.5568 7.5 10.9154 7.5 10.125C7.5 9.33464 8.088 8.69318 8.8125 8.69318C9.537 8.69318 10.125 9.33464 10.125 10.125ZM28.5 18C28.5 18.3952 28.206 18.7159 27.8438 18.7159H14.7188C14.3565 18.7159 14.0625 18.3952 14.0625 18C14.0625 17.6048 14.3565 17.2841 14.7188 17.2841H27.8438C28.206 17.2841 28.5 17.6048 28.5 18ZM10.125 18C10.125 18.7904 9.537 19.4318 8.8125 19.4318C8.088 19.4318 7.5 18.7904 7.5 18C7.5 17.2096 8.088 16.5682 8.8125 16.5682C9.537 16.5682 10.125 17.2096 10.125 18ZM28.5 25.875C28.5 26.2702 28.206 26.5909 27.8438 26.5909H14.7188C14.3565 26.5909 14.0625 26.2702 14.0625 25.875C14.0625 25.4798 14.3565 25.1591 14.7188 25.1591H27.8438C28.206 25.1591 28.5 25.4798 28.5 25.875ZM10.125 25.875C10.125 26.6654 9.537 27.3068 8.8125 27.3068C8.088 27.3068 7.5 26.6654 7.5 25.875C7.5 25.0846 8.088 24.4432 8.8125 24.4432C9.537 24.4432 10.125 25.0846 10.125 25.875Z" fill="black"/>
                                  </svg>
                                </a>




                                </span>
                                </div>




                                <div class="card-header head d-flex justify-content-between align-items-center">
                                    <span>
                                        <span class="card-header-txt">`+ b.ApplicationType + `</span><br>
                                        <span class="card-header-txt">`+ b.ApplicationId + ` </span>
                                    </span>
                                    <span class="d-flex justify-content-end">
                                        <span class="text-left">
                                            <span class="card-header-txt">Application Date </span><br>
                                            <span class="card-header-txt" title="`+ b.created_at + `">` + b.created_at + `</span>
                                        </span>
                                        <span>

                                    
                                        </span>
                                    </span>
                                </div>

                                <div class="card-body py-3">

                                    <div class="row">




                                        <div class="col-lg-12">
                                            <div class="card-header head d-flex justify-content-between p-0">
                                                <span>
                                                    <span class="card-header-txt"> From</span><br>
                                                    <span class="card-header-blue-txt">`+ b.start_date + `</span>
                                                </span>
                                                <span class="d-flex justify-content-between">
                                                    <span>
                                                  
                                                        <span class="card-header-txt">To </span><br>
                                                        <span class="card-header-blue-txt">`+ b.end_date + `</span>
                                              
                                                        
                                                    </span>


                                                </span>
                                                <span>
                                        
                                                                <span class="card-header-txt">`+ b.leavetype + `</span><br>
                                                                <span class="card-header-blue-txt">`+ b.total_days + ` Days</span>
                                                </span>
                                            </div>

                                        </div>

                                        <div class="col-lg-12">
                                                
                

                
                                                                <div class="card-header p-0">

                                                                    <span class="card-header-txt">
                                                                       
                                                                        Reason :</span><br>

                                                                    <span class="my-3 card-body-reason-text addReadMore showlesscontent "
                                                                        data-bs-toggle="tooltip" data-bs-placement="bottom"
                                                                        title="not available">`+ b.reason + `.</span>
                                                                </div>
                                                                
               
                                        </div>



                                    </div>

                                </div>

                                <div class="card-footer cardfooter mt-auto">
                                    <div class="row">

                                        <div class="col-lg-12 conclusion-box my-2">
                                            <div class="py-2 d-flex justify-content-between">
                                                <span class="image-list card-header-txt py-1 col-lg-8 col-md-6 col-sm-12"
                                                    style="display: flex; align-items: center;">

                                                        ${b.managers.map((l, index) => `
                                                            ${l.status === null ?
                `
                                                                <img class="manager-pic manager-pic-Pending  manager-image-picture1"
                                                                src="${l.manager_image}" data-bs-placement="top"
                                                                data-bs-toggle="tooltip" title="⏳ ${l.manager_name}" />                                                            
                                                                `
                : `
                                                        
                                                            `}
                                                        `).join("\n")}

                                                    <span class="ps-1">This application is `+ b.leave_status + `.</span>
                                                </span>

                                                <span
                                                    class="image-list d-flex justify-content-end managers-imgs col-lg-4 col-md-6 col-sm-12">

                                                        ${b.managers.map((l, index) => `
                                                            ${l.status === true ?
                    `
                                                                <img class="manager-pic manager-pic-Approved  manager-image-picture1"
                                                                src="${l.manager_image}" data-bs-placement="top"
                                                                data-bs-toggle="tooltip" title="✅ ${l.manager_name}" />                                                            
                                                                `
                    : ``}

                                                        `).join("\n")}
                                                            
                                                        ${b.managers.map((l, index) => `
                                                            ${l.status === false ?
                        `
                                                                <img class="manager-pic manager-pic-Rejected  manager-image-picture1"
                                                                src="${l.manager_image}" data-bs-placement="top"
                                                                data-bs-toggle="tooltip" title="❌ ${l.manager_name}" />                                                          
                                                                `
                        : ``}

                                                        `).join("\n")}

                                                        
                                                </span>
                                            </div>
                                        </div>
                                    </div>

                                    ${ b.leave_status === 'Pending' &&  b.manager_action === null? ` 

                                        <div class="row mt-2 ButttonStatus`+ b.approval_id + `">
                                            <div class="col-lg-6 col-md-12 col-sm-12 px-1">
                                                <button class="btn w-100  btn-danger" onclick="reject_application(`+ b.approval_id + `)">Reject</button>
                                            </div>
                          
                                            <div class="col-lg-6 col-md-12 col-sm-12 px-1">
                                                <button class="btn w-100   btn-success" onclick="approve_application(`+ b.approval_id + `)">Approve</button>
                                            </div>
                                        </div>
                                    ` : ``}
                                </div>






                            </div>

                        </div>

                    `
          });
          $('#' + status + '-applications').html(col_div)


          AddReadMore();
          AddReadMore1();

          var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
          var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) { return new bootstrap.Tooltip(tooltipTriggerEl) });


        }
        else {
          col_div += ` 
                    <div class="noappdiv">
                        <div class="text-center py-4 ">No Applications Found!</div>
                    </div>`
          $('#' + status + '-applications').html(col_div)



        }

      }
    });





  }

  function AddReadMore() {
    //This limit you can set after how much characters you want to show Read More.
    var carLmt = 95;
    // Text to show when text is collapsed
    var readMoreTxt = " ... Read More";
    // Text to show when text is expanded
    var readLessTxt = " Read Less";


    //Traverse all selectors with this class and manupulate HTML part to show Read More
    $(".addReadMore").each(function () {
      if ($(this).find(".firstSec").length)
        return;

      var allstr = $(this).text();
      if (allstr.length > carLmt) {
        var firstSet = allstr.substring(0, carLmt);
        var secdHalf = allstr.substring(carLmt, allstr.length);
        var strtoadd = firstSet + "<span class='SecSec'>" + secdHalf + "</span><span class='readMore'  title='Click to Show More'>" + readMoreTxt + "</span><span class='readLess' title='Click to Show Less'>" + readLessTxt + "</span>";
        $(this).html(strtoadd);
      }

    });
    //Read More and Read Less Click Event binding

  }
  function AddReadMore1() {
    //This limit you can set after how much characters you want to show Read More.
    var carLmt = 15;
    // Text to show when text is collapsed
    var readMoreTxt = " ... Read More";
    // Text to show when text is expanded
    var readLessTxt = " Read Less";


    //Traverse all selectors with this class and manupulate HTML part to show Read More
    $(".addReadMore1").each(function () {
      if ($(this).find(".firstSec").length)
        return;

      var allstr = $(this).text();
      if (allstr.length > carLmt) {
        var firstSet = allstr.substring(0, carLmt);
        var secdHalf = allstr.substring(carLmt, allstr.length);
        var strtoadd = firstSet + "<span class='SecSec1'>" + secdHalf + "</span><span class='readMore1'  title='Click to Show More'>" + readMoreTxt + "</span><span class='readLess1' title='Click to Show Less'>" + readLessTxt + "</span>";
        $(this).html(strtoadd);
      }

    });
    //Read More and Read Less Click Event binding

  }

  $(document).on("click", ".readMore,.readLess", function () {
    $(this).closest(".addReadMore").toggleClass("showlesscontent showmorecontent");
  });
  $(document).on("click", ".readMore1,.readLess1", function () {
    $(this).closest(".addReadMore1").toggleClass("showlesscontent1 showmorecontent1");
  });








  function getdepartmentlist() {
    var html = ''
    var fd = new FormData();
    fd.append("csrfmiddlewaretoken", "{{csrf_token}}");
    $.ajax({
      type: "POST",
      url: frontendURL + "getdepartmentlist",
      data: fd,
      processData: false,
      contentType: false,

      success: function (response) {
        var numberToCheck = '';



        html += `<option value="" >Select Department</option>`

        $(response.data).each(function (a, b) {
          html += `<option value="` + b.id + `">` + b.DepartmentName + `</option>`
        })
        $("#searchdept").html(html);

      },
    });
  }

  function approve_application(id) {
    swal({
      title: "Are you sure?",
      text: "you want to approve application !",
      icon: "warning",
      buttons: true,
      dangerMode: true
    })
      .then((willDelete) => {
        if (willDelete) {
          $.ajax({
            url: frontendURL + "leave/leaveactionFront",
            type: 'POST',
            headers: {
              'Authorization': 'Token {{token}}'
            },
            data: {
              csrfmiddlewaretoken: '{{ csrf_token }}',
              'id': id
            },
            dataType: 'json',
            beforeSend: function () {

              var PendingDivButttonStatus = ""
              PendingDivButttonStatus = `
                                <div class="col-lg-12 col-md-12 col-sm-12 px-0 ps-2">
                                <button class="btn w-100   btn-primary" >Loading...</button>
                                </div>
                            `

              $(".ButttonStatus" + id).html(PendingDivButttonStatus)


            },
            success: function (response) {

              if (response['response']['n'] == 1) {
                swal({
                  icon: "success",
                  title: "",
                  text: response['response']['msg'],
                  button: "Close",
                })

                var PendingDivButttonStatus = ""
                PendingDivButttonStatus = `
                                    <div class="col-lg-12 col-md-12 col-sm-12 px-0 ps-2">
                                        <button class="btn w-100   btn-success" >Approved</button>
                                    </div>
                                `
                $(".ButttonStatus" + id).html(PendingDivButttonStatus)



              }
              else {
                swal({
                  icon: "error",
                  title: "",
                  text: response['response']['msg'],
                  button: "Close",
                })
              }




            }
          });

        }
      })
  }

  function reject_application(id) {
    swal({
      title: "Are you sure?",
      text: "you want to reject application!",

      content: {
        element: "input",
        attributes: {
          placeholder: "Enter rejection reason",
          type: "text",
        },
      },
      icon: "warning",
      buttons: true,
      dangerMode: true


    })
      .then((reason) => {
        if (reason != null) {

          $.ajax({
            url: frontendURL + "leave/leaveactionFront",
            type: 'POST',
            headers: {
              'Authorization': 'Token {{token}}'
            },
            data: {
              csrfmiddlewaretoken: '{{ csrf_token }}',
              'id': id,
              'comment': reason,
            },
            dataType: 'json',
            beforeSend: function () {

              var PendingDivButttonStatus = ""
              PendingDivButttonStatus = `
                            <div class="col-lg-12 col-md-12 col-sm-12 px-0 ps-2">
                                <button class="btn w-100   btn-primary" >Loading...</button>
                            </div>
                            `

              $(".ButttonStatus" + id).html(PendingDivButttonStatus)


            },
            success: function (response) {

              if (response['response']['n'] == 1) {

                swal({
                  icon: "success",
                  title: "",
                  text: response['response']['msg'],
                  button: "Close",
                })
                var PendingDivButttonStatus = ""
                PendingDivButttonStatus = `
                                    <div class="col-lg-12 col-md-12 col-sm-12 px-0 ps-2">
                                    <button class="btn w-100   btn-danger" >Rejected</button>
                                    </div>
                                `
                $(".ButttonStatus" + id).html(PendingDivButttonStatus)



              }
              else {






                swal({
                  icon: "error",
                  title: "",
                  text: response['response']['msg'],
                  buttons: true,
                  dangerMode: true
                }).then((willDelete) => {
                  if (willDelete) {
                    reject_application(id)

                  }

                });
                var PendingDivButttonStatus = ""
                PendingDivButttonStatus = `
                                    <div class="col-lg-6 col-md-12 col-sm-12 px-1">
                                        <button class="btn w-100  btn-danger" onclick="reject_application(`+ id + `)">Reject</button>
                                    </div>
     
                                    <div class="col-lg-6 col-md-12 col-sm-12 px-1">
                                        <button class="btn w-100   btn-success" onclick="approve_application(`+ id + `)">Approve</button>
                                    </div>
                                `
                $(".ButttonStatus" + id).html(PendingDivButttonStatus)
              }




            }
          });


        }
      })
  }

  function re_approve_application(id) {
    swal({
      title: "Are you sure?",
      text: "you want to reverse decision  !",
      icon: "warning",
      buttons: true,
      dangerMode: true
    })
      .then((willDelete) => {
        if (willDelete) {
          $.ajax({
            url: frontendURL + "leave/approve_rejected_application",
            type: 'POST',
            headers: {
              'Authorization': 'Token {{token}}'
            },
            data: {
              csrfmiddlewaretoken: '{{ csrf_token }}',
              'id': id,
            },
            dataType: 'json',
            beforeSend: function () {

              swal({
                icon: "info",
                title: "",
                text: "Loading...",
                buttons: false,
              });

            },
            success: function (response) {
              if (response['response']['n'] == 1) {


                swal({
                  icon: "success",
                  title: "",
                  text: response['response']['msg'],
                  button: "Close",
                })

              }
              else {
                swal({
                  icon: "error",
                  title: "",
                  text: response['response']['msg'],
                  button: "Close",
                })
              }




            }
          });

        }
      })
  }

  function re_reject_application(id) {
    swal({
      title: "Are you sure?",
      text: "you want to reject application!",

      content: {
        element: "input",
        attributes: {
          placeholder: "Enter rejection reason",
          type: "text",
        },
      },
      icon: "warning",
      buttons: true,
      dangerMode: true


    })
      .then((reason) => {
        if (reason != null) {

          $.ajax({
            url: frontendURL + "leave/reject_approved_application",
            type: 'POST',
            headers: {
              'Authorization': 'Token {{token}}'
            },
            data: {
              csrfmiddlewaretoken: '{{ csrf_token }}',
              'id': id,
              'comment': reason,
            },
            dataType: 'json',
            beforeSend: function () {

              swal({
                  icon: "info",
                  title: "",
                  text: "Loading...",
                  buttons: false,
                });

            },
            success: function (response) {


              if (response['response']['n'] == 1) {


                swal({
                  icon: "success",
                  title: "",
                  text: response['response']['msg'],
                  button: "Close",
                })

              }
              else {
                swal({
                  icon: "error",
                  title: "",
                  text: response['response']['msg'],
                  button: "Close",
                })
              }


            }
          });


        }
      })
  }



</script>


{% endblock %}